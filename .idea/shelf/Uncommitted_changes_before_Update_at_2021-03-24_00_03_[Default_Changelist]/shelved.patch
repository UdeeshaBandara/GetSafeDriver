Index: app/src/main/java/lk/hd192/getsafedriver/Map.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package lk.hd192.getsafedriver;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.annotation.Nullable;\r\nimport androidx.core.app.ActivityCompat;\r\nimport androidx.core.content.ContextCompat;\r\n\r\nimport android.Manifest;\r\nimport android.app.Dialog;\r\nimport android.content.Context;\r\nimport android.content.pm.PackageManager;\r\nimport android.graphics.Bitmap;\r\nimport android.graphics.BitmapFactory;\r\nimport android.location.Location;\r\nimport android.location.LocationListener;\r\nimport android.location.LocationManager;\r\nimport android.os.AsyncTask;\r\nimport android.os.Bundle;\r\nimport android.os.CountDownTimer;\r\nimport android.util.Log;\r\nimport android.view.View;\r\nimport android.widget.Button;\r\nimport android.widget.LinearLayout;\r\nimport android.widget.TextView;\r\n\r\nimport com.google.android.gms.maps.CameraUpdateFactory;\r\nimport com.google.android.gms.maps.GoogleMap;\r\nimport com.google.android.gms.maps.MapView;\r\nimport com.google.android.gms.maps.MapsInitializer;\r\nimport com.google.android.gms.maps.OnMapReadyCallback;\r\nimport com.google.android.gms.maps.model.BitmapDescriptorFactory;\r\nimport com.google.android.gms.maps.model.CameraPosition;\r\nimport com.google.android.gms.maps.model.LatLng;\r\nimport com.google.android.gms.maps.model.LatLngBounds;\r\nimport com.google.android.gms.maps.model.MapStyleOptions;\r\nimport com.google.android.gms.maps.model.Marker;\r\nimport com.google.android.gms.maps.model.MarkerOptions;\r\nimport com.google.android.gms.maps.model.Polyline;\r\nimport com.google.android.gms.maps.model.PolylineOptions;\r\nimport com.google.firebase.database.ChildEventListener;\r\nimport com.google.firebase.database.DataSnapshot;\r\nimport com.google.firebase.database.DatabaseError;\r\nimport com.google.firebase.database.DatabaseReference;\r\nimport com.google.firebase.database.FirebaseDatabase;\r\nimport com.google.firebase.database.ValueEventListener;\r\n\r\nimport org.json.JSONArray;\r\nimport org.json.JSONObject;\r\n\r\nimport java.io.BufferedReader;\r\nimport java.io.IOException;\r\nimport java.io.InputStream;\r\nimport java.io.InputStreamReader;\r\nimport java.net.HttpURLConnection;\r\nimport java.net.URL;\r\nimport java.util.ArrayList;\r\nimport java.util.Arrays;\r\nimport java.util.Calendar;\r\nimport java.util.Collections;\r\nimport java.util.HashMap;\r\nimport java.util.List;\r\n\r\nimport lk.hd192.getsafedriver.Utils.DirectionJSONParser;\r\nimport lk.hd192.getsafedriver.Utils.GetSafeDriverBase;\r\nimport lk.hd192.getsafedriver.Utils.GetSafeDriverServices;\r\nimport lk.hd192.getsafedriver.Utils.LocationUpdates;\r\nimport lk.hd192.getsafedriver.Utils.TinyDB;\r\nimport lk.hd192.getsafedriver.Utils.UserLocation;\r\nimport lk.hd192.getsafedriver.Utils.VolleyJsonCallback;\r\n\r\npublic class Map extends GetSafeDriverBase {\r\n\r\n    MapView mapView;\r\n\r\n\r\n    private GoogleMap googleMap;\r\n    ArrayList<UserLocation> dropOffLocations = new ArrayList<>();\r\n    LocationManager locationManager;\r\n    GetSafeDriverServices getSafeDriverServices;\r\n    private DatabaseReference mRootRef, locationRef;\r\n    String locationProvider = LocationManager.GPS_PROVIDER;\r\n    CameraPosition cameraPosition;\r\n    TextView txt_name, txt_distance, txt_time;\r\n\r\n    String wayPoints;\r\n    LinearLayout lnr_trip_details;\r\nTextView txt_error;\r\n    JSONArray passengerList;\r\n    Polyline polyline;\r\n    LocationListener locationListener;\r\n    LocationManager locationManagerSender;\r\n    TinyDB tinyDB;\r\n    Bitmap originMarker, finalMarker;\r\n    Button btn_start_trip, btn_absent, btn_dropNPick;\r\n    Double currentLat, currentLon;\r\n    Dialog dialog;\r\n    Boolean isPickingCompleted = false;\r\n\r\n    public static ArrayList<String> duration = new ArrayList<>();\r\n    public static ArrayList<String> distance = new ArrayList<>();\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_map);\r\n\r\n\r\n        dialog = new Dialog(this, android.R.style.Theme_Translucent_NoTitleBar_Fullscreen);\r\n\r\n        getSafeDriverServices = new GetSafeDriverServices();\r\n        tinyDB = new TinyDB(getApplicationContext());\r\n        mapView = findViewById(R.id.mapView);\r\n        btn_start_trip = findViewById(R.id.btn_start_trip);\r\n        txt_time = findViewById(R.id.txt_time);\r\n        txt_distance = findViewById(R.id.txt_distance);\r\n        txt_name = findViewById(R.id.txt_name);\r\n        btn_absent = findViewById(R.id.btn_absent);\r\n        btn_dropNPick = findViewById(R.id.btn_dropNPick);\r\n        lnr_trip_details = findViewById(R.id.lnr_trip_details);\r\n        txt_error = findViewById(R.id.txt_error);\r\n\r\n        mRootRef = FirebaseDatabase.getInstance().getReference();\r\n\r\n//        btnBack = findViewById(R.id.btn_location_back);\r\n\r\n//        database = FirebaseDatabase.getInstance();\r\n//        myRef = database.getReference(\"message\");\r\n//        Query lastQuery = myRef.orderByKey().limitToLast(1);\r\n\r\n        findViewById(R.id.btn_back).setOnClickListener(v -> onBackPressed());\r\n\r\n        tinyDB.putString(\"driver_id\",\"5\");\r\n\r\n        if (tinyDB.getBoolean(\"isStaffDriver\"))\r\n            locationRef = mRootRef.child(\"Staff_Drivers\").child(tinyDB.getString(\"driver_id\")).child(tinyDB.getString(\"driver_id\")).child(\"Location\");\r\n        else\r\n            locationRef = mRootRef.child(\"School_Drivers\").child(tinyDB.getString(\"driver_id\")).child(tinyDB.getString(\"driver_id\")).child(\"Location\");\r\n\r\n\r\n        if (ActivityCompat.checkSelfPermission(Map.this, android.Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED && ActivityCompat.checkSelfPermission(Map.this, android.Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED) {\r\n\r\n            askForPermission(android.Manifest.permission.ACCESS_FINE_LOCATION, 100);\r\n            return;\r\n        }\r\n\r\n        locationManager = (LocationManager) getSystemService(Context.LOCATION_SERVICE);\r\n\r\n        originMarker = bitmapSizeByScale(BitmapFactory.decodeResource(getResources(), R.drawable.marker_passenger), 1);\r\n        finalMarker = bitmapSizeByScale(BitmapFactory.decodeResource(getResources(), R.drawable.marker_end), 1);\r\n\r\n        currentLat = 6.965495959761049;\r\n        currentLon = 79.95475497680536;\r\n\r\n//        btnBack.setOnClickListener(new View.OnClickListener() {\r\n//            @Override\r\n//            public void onClick(View v) {\r\n//                onBackPressed();\r\n//            }\r\n//        });\r\n        btn_absent.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                for (UserLocation user : dropOffLocations) {\r\n                    if (user.getPassengerName().equals(txt_name.getText().toString())) {\r\n                        user.setAbsent(true);\r\n                        markAbsent(user.getId());\r\n                        ArrayList<String> strList = (ArrayList<String>) (ArrayList<?>) (dropOffLocations);\r\n                        tinyDB.putListString(\"tripRoute\", strList);\r\n                    }\r\n                    if (!user.getPicked())\r\n                        if (user.getAbsent())\r\n\r\n                            isPickingCompleted = true;\r\n                        else\r\n                            isPickingCompleted = false;\r\n                    else\r\n                        isPickingCompleted = true;\r\n                }\r\n\r\n                Log.e(\"trip status absent\",isPickingCompleted+\"\");\r\n\r\n            }\r\n        });\r\n        btn_dropNPick.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n//                isPickingCompleted = true;\r\n                for (UserLocation user : dropOffLocations) {\r\n                    if (user.getPassengerName().equals(txt_name.getText().toString())) {\r\n                        if (user.getPicked()) {\r\n                            dropOffPassenger(user.getId());\r\n                            user.setDropped(true);\r\n                        } else {\r\n                            pickUpPassenger(user.getId());\r\n                            user.setPicked(true);\r\n                        }\r\n                        ArrayList<String> strList = (ArrayList<String>) (ArrayList<?>) (dropOffLocations);\r\n                        tinyDB.putListString(\"tripRoute\", strList);\r\n                    }\r\n                    if (!user.getPicked())\r\n                        if (user.getAbsent())\r\n\r\n                            isPickingCompleted = true;\r\n                        else\r\n                            isPickingCompleted = false;\r\n                    else\r\n                        isPickingCompleted = true;\r\n                }\r\n\r\n                if (isPickingCompleted)\r\n                    drawMapPolyline(new LatLng(currentLat, currentLon));\r\n\r\n\r\n                Log.e(\"trip status pick\",isPickingCompleted+\"\");\r\n            }\r\n        });\r\n        btn_start_trip.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n\r\n                Calendar c = Calendar.getInstance();\r\n                int timeOfDay = c.get(Calendar.HOUR_OF_DAY);\r\n\r\n\r\n                if (btn_start_trip.getText().toString().equals(\"Start Trip\")) {\r\n                    txt_error.setVisibility(View.GONE);\r\n                    lnr_trip_details.setVisibility(View.VISIBLE);\r\n                    tinyDB.putBoolean(\"isTripStart\", true);\r\n\r\n\r\n\r\n                    Log.e(\"drop offs\", tinyDB.getListString(\"tripRoute\") + \"\");\r\n                    btn_start_trip.setBackground(getResources().getDrawable(R.drawable.bg_btn_stop));\r\n                    if (timeOfDay >= 0 && timeOfDay < 12) {\r\n\r\n                        getMorningList();\r\n                    } else if (timeOfDay >= 12) {\r\n                        getEveningList();\r\n                    }\r\n\r\n                    notifyTripStart();\r\n                    btn_start_trip.setText(\"End Trip\");\r\n                    locationRef.child(\"status\").setValue(btn_start_trip.getText().toString());\r\n\r\n                } else {\r\n\r\n                    notifyTripEnd();\r\n                    dropOffLocations.clear();\r\n                    txt_error.setVisibility(View.VISIBLE);\r\n                    lnr_trip_details.setVisibility(View.GONE);\r\n                    distance.clear();\r\n                    googleMap.clear();\r\n                    duration.clear();\r\n                    tinyDB.putBoolean(\"isTripStart\", false);\r\n                    tinyDB.remove(\"tripRoute\");\r\n\r\n                    btn_start_trip.setBackground(getResources().getDrawable(R.drawable.bg_btn_ok));\r\n                    btn_start_trip.setText(\"Start Trip\");\r\n                    locationRef.child(\"status\").setValue(btn_start_trip.getText().toString());\r\n\r\n                }\r\n\r\n\r\n            }\r\n        });\r\n\r\n        locationListener = new LocationListener() {\r\n            @Override\r\n            public void onLocationChanged(Location location) {\r\n\r\n//                LocationUpdates locationUpdates= new LocationUpdates( location.getLatitude(), location.getLongitude());\r\n//                locationRef.setValue(locationUpdates);\r\n\r\n//                locationRef.child(\"latitude\").setValue(location.getLatitude());\r\n//                locationRef.child(\"longitude\").setValue(location.getLongitude());\r\n                // pushId++;\r\n                java.util.Map messageMap = new HashMap();\r\n                messageMap.put(\"latitude\", location.getLatitude());\r\n                messageMap.put(\"longitude\", location.getLongitude());\r\n                messageMap.put(\"status\", btn_start_trip.getText().toString());\r\n\r\n\r\n                locationRef.updateChildren(messageMap, new DatabaseReference.CompletionListener() {\r\n                    @Override\r\n                    public void onComplete(@Nullable DatabaseError databaseError, @NonNull DatabaseReference databaseReference) {\r\n                        if (databaseError != null) {\r\n                            Log.e(\"Error\", databaseError.getMessage());\r\n                        }\r\n                    }\r\n                });\r\n\r\n            }\r\n\r\n            @Override\r\n            public void onStatusChanged(String provider, int status, Bundle extras) {\r\n\r\n            }\r\n\r\n            @Override\r\n            public void onProviderEnabled(String provider) {\r\n\r\n            }\r\n\r\n            @Override\r\n            public void onProviderDisabled(String provider) {\r\n\r\n            }\r\n\r\n\r\n        };\r\n\r\n        locationManagerSender = (LocationManager) getApplicationContext().getSystemService(Context.LOCATION_SERVICE);\r\n\r\n        //noinspection MissingPermission\r\n        if (ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED && ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED) {\r\n            // TODO: Consider calling\r\n            //    ActivityCompat#requestPermissions\r\n            // here to request the missing permissions, and then overriding\r\n            //   public void onRequestPermissionsResult(int requestCode, String[] permissions,\r\n            //                                          int[] grantResults)\r\n            // to handle the case where the user grants the permission. See the documentation\r\n            // for ActivityCompat#requestPermissions for more details.\r\n            return;\r\n        }\r\n        locationManagerSender.requestLocationUpdates(LocationManager.GPS_PROVIDER, 12000, 0, locationListener);\r\n\r\n        locationRef.addValueEventListener(new ValueEventListener() {\r\n            @Override\r\n            public void onDataChange(@NonNull DataSnapshot snapshot) {\r\n                try {\r\n                    Log.e(\"onChildChanged\", \"exe\");\r\n                    LocationUpdates locationUpdates = snapshot.getValue(LocationUpdates.class);\r\n                    currentLat = locationUpdates.getLatitude();\r\n                    currentLon = locationUpdates.getLongitude();\r\n                    googleMap.clear();\r\n\r\n                    drawMapPolyline(new LatLng(currentLat, currentLon));\r\n                } catch (Exception e) {\r\n                    e.printStackTrace();\r\n                }\r\n            }\r\n\r\n            @Override\r\n            public void onCancelled(@NonNull DatabaseError error) {\r\n\r\n            }\r\n        });\r\n\r\n\r\n\r\n\r\n        try {\r\n\r\n            MapsInitializer.initialize(getApplicationContext());\r\n            loadMap();\r\n\r\n        } catch (Exception e) {\r\n\r\n            Log.e(\"Map Load Err >> \", e + \"\");\r\n            e.printStackTrace();\r\n\r\n        }\r\n//        findViewById(R.id.btn_location_back).setOnClickListener(new View.OnClickListener() {\r\n//            @Override\r\n//            public void onClick(View v) {\r\n//                onBackPressed();\r\n//            }\r\n//        });\r\n\r\n        mapView.onCreate(savedInstanceState);\r\n        mapView.onResume();\r\n\r\n    }\r\n\r\n    @Override\r\n    protected void onResume() {\r\n        super.onResume();\r\n        if (tinyDB.getBoolean(\"isTripStart\")) {\r\n\r\n//            btn_start_trip.setBackground(getResources().getDrawable(R.drawable.bg_btn_stop));\r\n//            btn_start_trip.setText(\"End Trip\");\r\n//            txt_error.setVisibility(View.GONE);\r\n//            lnr_trip_details.setVisibility(View.VISIBLE);\r\n//            dropOffLocations = new ArrayList<>();\r\n////            for (String s :  tinyDB.getListString(\"tripRoute\")) {\r\n//////                Object o=s;\r\n//////                userLocation.fo\r\n////\r\n////            }\r\n//            dropOffLocations.add(new UserLocation(tinyDB.getListString(\"tripRoute\").get(0)));\r\n//\r\n//            Log.e(\"FROM string\",  tinyDB.getListString(\"tripRoute\").get(0)+\"\");\r\n//            Log.e(\"formt iny\",  dropOffLocations.get(0).getDropLatitude()+\"\");\r\n//            drawMapPolyline(new LatLng(currentLat, currentLon));\r\n\r\n\r\n        }\r\n        else{\r\n\r\n            txt_error.setVisibility(View.VISIBLE);\r\n            lnr_trip_details.setVisibility(View.GONE);\r\n        }\r\n    }\r\n\r\n\r\n    @Override\r\n    protected void onStop() {\r\n\r\n        if (!dropOffLocations.isEmpty()) {\r\n\r\n            ArrayList<String> strings = new ArrayList<>();\r\n            for (Object object : dropOffLocations) {\r\n                strings.add(object != null ? object.toString() : null);\r\n            }\r\n            tinyDB.putListString(\"tripRoute\", strings);\r\n            Log.e(\"tiny\", tinyDB.getListString(\"tripRoute\") + \"\");\r\n            distance.clear();\r\n            googleMap.clear();\r\n            duration.clear();\r\n\r\n            Log.e(\"new array\", dropOffLocations.get(0) + \"\");\r\n\r\n        }\r\n\r\n        super.onStop();\r\n\r\n    }\r\n\r\n    public void loadMap() {\r\n\r\n        mapView.getMapAsync(new OnMapReadyCallback() {\r\n            @Override\r\n            public void onMapReady(GoogleMap gMap) {\r\n\r\n                googleMap = gMap;\r\n                googleMap.setMapStyle(\r\n                        MapStyleOptions.loadRawResourceStyle(\r\n                                getApplicationContext(), R.raw.dark_map));\r\n                if (ActivityCompat.checkSelfPermission(Map.this, android.Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED && ActivityCompat.checkSelfPermission(Map.this, android.Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED) {\r\n\r\n                    askForPermission(android.Manifest.permission.ACCESS_FINE_LOCATION, 100);\r\n                    return;\r\n                }\r\n\r\n\r\n                googleMap.setMyLocationEnabled(false);\r\n\r\n                try {\r\n\r\n\r\n                    new CountDownTimer(2000, 1000) {\r\n\r\n                        @Override\r\n                        public void onTick(long millisUntilFinished) {\r\n\r\n                        }\r\n\r\n                        @Override\r\n                        public void onFinish() {\r\n\r\n\r\n                        }\r\n                    }.start();\r\n\r\n\r\n                } catch (Exception e) {\r\n\r\n\r\n                    //Toast.makeText(getApplicationContext(), \"Something Went Wrong in Location Service !\", Toast.LENGTH_SHORT).show();\r\n\r\n                }\r\n\r\n\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n\r\n    private void askForPermission(String permission, Integer requestCode) {\r\n        if (ContextCompat.checkSelfPermission(Map.this, permission) != PackageManager.PERMISSION_GRANTED) {\r\n\r\n            // Should we show an explanation?\r\n            if (ActivityCompat.shouldShowRequestPermissionRationale(Map.this, permission)) {\r\n\r\n                //This is called if user has denied the permission before\r\n                //In this case I am just asking the permission again\r\n                ActivityCompat.requestPermissions(Map.this, new String[]{permission}, requestCode);\r\n\r\n            } else {\r\n\r\n                ActivityCompat.requestPermissions(Map.this, new String[]{permission}, requestCode);\r\n            }\r\n        } else {\r\n            //Toast.makeText(this, \"\" + permission + \" is already granted.\", Toast.LENGTH_SHORT).show();\r\n        }\r\n    }\r\n\r\n    //\r\n//    public void locationAddress(double lat, double lon) {\r\n//        Geocoder geocoder;\r\n//        List<Address> addressList;\r\n//\r\n//        geocoder = new Geocoder(this, Locale.getDefault());\r\n//\r\n//        try {\r\n//            addressList = geocoder.getFromLocation(lat, lon, 1);\r\n//\r\n//            Log.e(\"address\", addressList.size() + \" \");\r\n//\r\n//            if (addressList.size() == 0) {\r\n//\r\n//                showToast(dialog, \"Oops.. \\nNo Address Found in this Area \", 1);\r\n//\r\n//\r\n//            } else {\r\n////                mConfirm.setEnabled(true);\r\n////                LOC_ADDRESS = addressList.get(0).getAddressLine(0);\r\n//            }\r\n//\r\n//\r\n//        } catch (IOException e) {\r\n//\r\n//\r\n//            showToast(dialog, \"Oops.. \\nan error occurred \", 0);\r\n//\r\n//            e.printStackTrace();\r\n//        }\r\n//    }\r\n\r\n\r\n//    float[] result=new float[100];\r\n//    private void sortLocations() {\r\n//        try {\r\n//        result[0]=3;\r\n//        result[1]=3;\r\n//        result[2]=3;\r\n//\r\n//    for (int counter = 1; counter < dropOffLocations.size() - 1; counter++) {\r\n//\r\n//\r\n//        Location.distanceBetween(dropOffLocations.get(0).getLatitude(),\r\n//                dropOffLocations.get(0).getLongitude(),\r\n//                dropOffLocations.get(counter).getLatitude(),\r\n//                dropOffLocations.get(counter).getLongitude(), result);\r\n//\r\n//        Log.e(\"sorted dis\",  counter+\"\");\r\n//        Log.e(\"sorted dis\",  result.length+\"\");\r\n//        Collections.sort(dropOffLocations);\r\n//    }\r\n//\r\n//}catch (Exception e){\r\n//    Log.e(\"sort ex\",e.getMessage());\r\n//}\r\n//    }\r\n\r\n    public void drawMapPolyline(LatLng origin) {\r\n        Log.e(\"draw polyline\",\"exe\");\r\n        try {\r\n\r\n            for (int f = 0; f < distance.size(); f++) {\r\n                if (Double.parseDouble(distance.get(f)) < 500)\r\n                    informDriverArrival(dropOffLocations.get(f).getId());\r\n\r\n            }\r\n            LatLng dest;\r\n\r\n            if (dropOffLocations.size() != 0) {\r\n\r\n                if (isPickingCompleted) {\r\n                    dest = new LatLng(dropOffLocations.get(dropOffLocations.size() - 1).getDropLatitude(), dropOffLocations.get(dropOffLocations.size() - 1).getDropLongitude());\r\n\r\n                    googleMap.addMarker(new MarkerOptions()\r\n                            .position(origin).icon(BitmapDescriptorFactory.fromBitmap(finalMarker)).title(\"Your location\"));\r\n\r\n\r\n                    wayPoints = \"&waypoints=\";\r\n                    for (int l = 0; l < dropOffLocations.size(); l++) {\r\n\r\n                        if (dropOffLocations.size() - 1 == l) {\r\n                            googleMap.addMarker(new MarkerOptions()\r\n                                    .position(dest).icon(BitmapDescriptorFactory.fromBitmap(finalMarker)).title(dropOffLocations.get(l).getPassengerName()));\r\n                            continue;\r\n                        }\r\n                        if (l == 0)\r\n\r\n                            wayPoints += dropOffLocations.get(l).getDropLatitude() + \",\" + dropOffLocations.get(l).getDropLongitude();\r\n\r\n                        else\r\n                            wayPoints += \"|\" + dropOffLocations.get(l).getDropLatitude() + \",\" + dropOffLocations.get(l).getDropLongitude();\r\n\r\n\r\n                        googleMap.addMarker(new MarkerOptions()\r\n                                .position(new LatLng(dropOffLocations.get(l).getDropLatitude(), dropOffLocations.get(l).getDropLongitude())).icon(BitmapDescriptorFactory.fromBitmap(originMarker)).title(dropOffLocations.get(l).getPassengerName()));\r\n\r\n\r\n                    }\r\n                } else {\r\n\r\n                    dest = new LatLng(dropOffLocations.get(dropOffLocations.size() - 1).getPickUpLatitude(), dropOffLocations.get(dropOffLocations.size() - 1).getPickUpLongitude());\r\n                    googleMap.addMarker(new MarkerOptions()\r\n                            .position(origin).icon(BitmapDescriptorFactory.fromBitmap(finalMarker)).title(\"Your location\"));\r\n\r\n\r\n                    wayPoints = \"&waypoints=\";\r\n                    for (int l = 0; l < dropOffLocations.size(); l++) {\r\n\r\n                        if (dropOffLocations.size() - 1 == l) {\r\n                            googleMap.addMarker(new MarkerOptions()\r\n                                    .position(dest).icon(BitmapDescriptorFactory.fromBitmap(finalMarker)).title(dropOffLocations.get(l).getPassengerName()));\r\n                            continue;\r\n                        }\r\n                        if (l == 0)\r\n\r\n                            wayPoints += dropOffLocations.get(l).getPickUpLatitude() + \",\" + dropOffLocations.get(l).getPickUpLongitude();\r\n\r\n                        else\r\n                            wayPoints += \"|\" + dropOffLocations.get(l).getPickUpLatitude() + \",\" + dropOffLocations.get(l).getPickUpLongitude();\r\n\r\n\r\n                        googleMap.addMarker(new MarkerOptions()\r\n                                .position(new LatLng(dropOffLocations.get(l).getPickUpLatitude(), dropOffLocations.get(l).getPickUpLongitude())).icon(BitmapDescriptorFactory.fromBitmap(originMarker)).title(dropOffLocations.get(l).getPassengerName()));\r\n\r\n\r\n                    }\r\n                }\r\n\r\n                googleMap.setOnMarkerClickListener(new GoogleMap.OnMarkerClickListener() {\r\n                    @Override\r\n                    public boolean onMarkerClick(Marker marker) {\r\n//                            Log.e(\"selected latlong\", marker.getPosition() + \"\");\r\n                        for (int v = 0; v < dropOffLocations.size(); v++) {\r\n                            if (dropOffLocations.get(v).getPassengerName().equals(marker.getTitle()))\r\n                                if (distance.size() != 0 & duration.size() != 0) {\r\n                                    txt_name.setText(\": \" + dropOffLocations.get(v).getPassengerName());\r\n                                    txt_distance.setText(\": \" + distance.get(v));\r\n                                    txt_time.setText(\": \" + duration.get(v));\r\n                                } else {\r\n\r\n                                    txt_name.setText(\"\");\r\n                                    txt_distance.setText(\"\");\r\n                                    txt_time.setText(\"\");\r\n                                }\r\n\r\n                        }\r\n\r\n                        return false;\r\n                    }\r\n                });\r\n                LatLngBounds.Builder builder = new LatLngBounds.Builder();\r\n                builder.include(origin);\r\n                builder.include(dest);\r\n\r\n                LatLngBounds bounds = builder.build();\r\n\r\n                googleMap.moveCamera(CameraUpdateFactory.newLatLngBounds(bounds, 75));\r\n\r\n                CameraPosition camPos = new CameraPosition.Builder(googleMap.getCameraPosition()).target(bounds.getCenter()).tilt(35).build();\r\n                googleMap.animateCamera(CameraUpdateFactory\r\n                        .newCameraPosition(camPos));\r\n//\r\n//        int padding = 1;\r\n//\r\n//        CameraUpdate cu = CameraUpdateFactory.newLatLngBounds(bounds,padding);\r\n\r\n\r\n//        googleMap.animateCamera(cu);\r\n\r\n\r\n                String url = getDirectionsUrl(origin, dest);\r\n\r\n\r\n                DownloadTask downloadTask = new DownloadTask();\r\n\r\n\r\n                downloadTask.execute(url);\r\n            }\r\n        }\r\n        catch (Exception e){\r\n            Log.e(\"ez\",e.getMessage());\r\n         e.printStackTrace();\r\n        }\r\n\r\n    }\r\n\r\n\r\n    private String getDirectionsUrl(LatLng origin, LatLng dest) {\r\n\r\n        // Origin of route\r\n        String str_origin = \"origin=\" + origin.latitude + \",\" + origin.longitude;\r\n\r\n        // Destination of route\r\n        String str_dest = \"destination=\" + dest.latitude + \",\" + dest.longitude;\r\n\r\n        //avoid highways\r\n        String avoidList = \"&avoid=highways\";\r\n\r\n\r\n        // Building the parameters to the web service\r\n        String parameters = str_origin + \"&\" + str_dest + wayPoints + avoidList + \"&key=\" + getString(R.string.API_KEY);\r\n\r\n        // Output format\r\n        String output = \"json\";\r\n\r\n\r\n        // Building the url to the web service\r\n        String url = \"https://maps.googleapis.com/maps/api/directions/\" + output + \"?\" + parameters;\r\n\r\n        Log.e(\"direction url\", url);\r\n\r\n        return url;\r\n    }\r\n\r\n    /**\r\n     * A method to download json data from url\r\n     */\r\n    private String downloadUrl(String strUrl) throws IOException {\r\n        String data = \"\";\r\n        InputStream iStream = null;\r\n        HttpURLConnection urlConnection = null;\r\n        try {\r\n            URL url = new URL(strUrl);\r\n\r\n            // Creating an http connection to communicate with url\r\n            urlConnection = (HttpURLConnection) url.openConnection();\r\n\r\n            // Connecting to url\r\n            urlConnection.connect();\r\n\r\n            // Reading data from url\r\n            iStream = urlConnection.getInputStream();\r\n\r\n            BufferedReader br = new BufferedReader(new InputStreamReader(iStream));\r\n\r\n            StringBuffer sb = new StringBuffer();\r\n\r\n            String line = \"\";\r\n            while ((line = br.readLine()) != null) {\r\n                sb.append(line);\r\n            }\r\n\r\n            data = sb.toString();\r\n\r\n            br.close();\r\n\r\n        } catch (Exception e) {\r\n            Log.d(\"Exception url\", e.toString());\r\n        } finally {\r\n            iStream.close();\r\n            urlConnection.disconnect();\r\n        }\r\n        return data;\r\n    }\r\n\r\n    // Fetches data from url passed\r\n    private class DownloadTask extends AsyncTask<String, Void, String> {\r\n\r\n        // Downloading data in non-ui thread\r\n        @Override\r\n        protected String doInBackground(String... url) {\r\n\r\n            // For storing data from web service\r\n            String data = \"\";\r\n\r\n            try {\r\n                // Fetching the data from web service\r\n                data = downloadUrl(url[0]);\r\n            } catch (Exception e) {\r\n                Log.d(\"Background Task\", e.toString());\r\n            }\r\n            return data;\r\n        }\r\n\r\n        // Executes in UI thread, after the execution of\r\n        // doInBackground()\r\n        @Override\r\n        protected void onPostExecute(String result) {\r\n            super.onPostExecute(result);\r\n\r\n            ParserTask parserTask = new ParserTask();\r\n\r\n            // Invokes the thread for parsing the JSON data\r\n            parserTask.execute(result);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * A class to parse the Google Places in JSON format\r\n     */\r\n    private class ParserTask extends AsyncTask<String, Integer, List<List<HashMap<String, String>>>> {\r\n\r\n        // Parsing the data in non-ui thread\r\n        @Override\r\n        protected List<List<HashMap<String, String>>> doInBackground(String... jsonData) {\r\n\r\n            JSONObject jObject;\r\n            List<List<HashMap<String, String>>> routes = null;\r\n\r\n            try {\r\n                jObject = new JSONObject(jsonData[0]);\r\n                DirectionJSONParser parser = new DirectionJSONParser();\r\n\r\n                // Starts parsing data\r\n                routes = parser.parse(jObject);\r\n            } catch (Exception e) {\r\n                e.printStackTrace();\r\n            }\r\n            return routes;\r\n        }\r\n\r\n        // Executes in UI thread, after the parsing process\r\n        @Override\r\n        protected void onPostExecute(List<List<HashMap<String, String>>> result) {\r\n            ArrayList<LatLng> points = null;\r\n            PolylineOptions lineOptions = null;\r\n            MarkerOptions markerOptions = new MarkerOptions();\r\n\r\n\r\n//            Log.e(\"POLY - results \", result + \"\");\r\n\r\n            // Traversing through all the routes\r\n            for (int i = 0; i < result.size(); i++) {\r\n                points = new ArrayList<LatLng>();\r\n                lineOptions = new PolylineOptions();\r\n\r\n                // Fetching i-th route\r\n                List<HashMap<String, String>> path = result.get(i);\r\n\r\n                // Fetching all the points in i-th route\r\n                for (int j = 0; j < path.size(); j++) {\r\n                    HashMap<String, String> point = path.get(j);\r\n\r\n                    double lat = Double.parseDouble(point.get(\"lat\"));\r\n                    double lng = Double.parseDouble(point.get(\"lng\"));\r\n                    LatLng position = new LatLng(lat, lng);\r\n\r\n                    points.add(position);\r\n                }\r\n\r\n                // Adding all the points in the route to LineOptions\r\n                lineOptions.addAll(points);\r\n                lineOptions.width(14);\r\n                lineOptions.color(getResources().getColor(R.color.button_blue));\r\n            }\r\n\r\n            // Drawing polyline in the Google Map for the i-th route\r\n\r\n            if (polyline != null) {\r\n                polyline.remove();\r\n            }\r\n\r\n            try {\r\n\r\n                polyline = Map.this.googleMap.addPolyline(lineOptions);\r\n\r\n            } catch (Exception e) {\r\n                e.printStackTrace();\r\n            }\r\n\r\n\r\n//            googleMap.addPolyline(lineOptions);\r\n        }\r\n    }\r\n\r\n\r\n    public Bitmap bitmapSizeByScale(Bitmap bitmapIn, float scale_zero_to_one_f) {\r\n\r\n        Bitmap bitmapOut = Bitmap.createScaledBitmap(bitmapIn,\r\n                Math.round(bitmapIn.getWidth() * scale_zero_to_one_f),\r\n                Math.round(bitmapIn.getHeight() * scale_zero_to_one_f), false);\r\n\r\n        return bitmapOut;\r\n    }\r\n\r\n    public Double calculateDistance(Double latOne, Double lonOne, Double latTwo, Double lonTwo) {\r\n\r\n        // The math module contains a function\r\n        // named toRadians which converts from\r\n        // degrees to radians.\r\n        lonOne = Math.toRadians(lonOne);\r\n        lonTwo = Math.toRadians(lonTwo);\r\n        latOne = Math.toRadians(latOne);\r\n        latTwo = Math.toRadians(latTwo);\r\n\r\n        // Haversine formula\r\n        double dlon = lonTwo - lonOne;\r\n        double dlat = latTwo - latOne;\r\n        double a = Math.pow(Math.sin(dlat / 2), 2)\r\n                + Math.cos(latOne) * Math.cos(latTwo)\r\n                * Math.pow(Math.sin(dlon / 2), 2);\r\n\r\n        double c = 2 * Math.asin(Math.sqrt(a));\r\n\r\n        // Radius of earth in kilometers. Use 3956\r\n        // for miles\r\n        double r = 6371;\r\n\r\n        // calculate the result\r\n        return (c * r) * 1000;\r\n    }\r\n\r\n    void getPickupLatLong() {\r\n        try {\r\n            Log.e(\"getPickupLatLong\",\"exe\");\r\n            for (int jk = 0; jk < passengerList.length(); jk++) {\r\n\r\n                dropOffLocations.add(jk, new UserLocation(passengerList.getJSONObject(jk).getString(\"id\"), passengerList.getJSONObject(jk).getString(\"name\"), passengerList.getJSONObject(jk).getJSONObject(\"location\").getDouble(\"pick_up_latitude\"), passengerList.getJSONObject(jk).getJSONObject(\"location\").getDouble(\"pick_up_longitude\"), passengerList.getJSONObject(jk).getJSONObject(\"location\").getDouble(\"drop_off_latitude\"), passengerList.getJSONObject(jk).getJSONObject(\"location\").getDouble(\"drop_off_longitude\"), calculateDistance(currentLat, currentLon, passengerList.getJSONObject(jk).getJSONObject(\"location\").getDouble(\"pick_up_latitude\"), passengerList.getJSONObject(jk).getJSONObject(\"location\").getDouble(\"pick_up_longitude\")), false, false, false));\r\n\r\n            }\r\n            Collections.sort(dropOffLocations);\r\n            for (int h = 0; h < dropOffLocations.size(); h++) {\r\n\r\n                Log.e(\"distance  \", dropOffLocations.get(h).getDistance() + \"\");\r\n\r\n            }\r\n            drawMapPolyline(new LatLng(currentLat, currentLon));\r\n            ArrayList<String> strList = (ArrayList<String>) (ArrayList<?>) (dropOffLocations);\r\n            tinyDB.putListString(\"tripRoute\", strList);\r\n        } catch (Exception e) {\r\n            e.printStackTrace();\r\n\r\n        }\r\n\r\n    }\r\n\r\n    void getDropLatLong() {\r\n//        try {\r\n//            Log.e(\"eve\", \"list\");\r\n//            for (int jk = 0; jk < passengerList.length(); jk++) {\r\n//\r\n//                dropOffLocations.add(jk, new UserLocation(passengerList.getJSONObject(jk).getString(\"name\"),  calculateDistance(currentLat, currentLon, passengerList.getJSONObject(jk).getJSONObject(\"location\").getDouble(\"drop_off_latitude\"), passengerList.getJSONObject(jk).getJSONObject(\"location\").getDouble(\"drop_off_longitude\"))));\r\n//\r\n//            }\r\n//            Collections.sort(dropOffLocations);\r\n//            drawMapPolyline(new LatLng(dropOffLocations.get(0).getLatitude(), dropOffLocations.get(0).getLongitude()));\r\n//        } catch (Exception e) {\r\n//\r\n//        }\r\n\r\n    }\r\n\r\n    private void getMorningList() {\r\n\r\n        HashMap<String, String> tempParam = new HashMap<>();\r\n\r\n\r\n        getSafeDriverServices.networkJsonRequestWithHeaders(this, tempParam, getString(R.string.BASE_URL) + getString(R.string.JOURNEY_LIST_MORNING), 1, tinyDB.getString(\"token\"), new VolleyJsonCallback() {\r\n\r\n            @Override\r\n            public void onSuccessResponse(JSONObject result) {\r\n\r\n                try {\r\n                    passengerList = new JSONArray();\r\n\r\n\r\n                    if (result.getBoolean(\"status\")) {\r\n                        Log.e(\"response\", \"ok\");\r\n                        passengerList = result.getJSONArray(\"models\");\r\n                        getPickupLatLong();\r\n                    } else\r\n                        showToast(dialog, result.getString(\"validation_errors\"), 0);\r\n\r\n\r\n                } catch (Exception e) {\r\n\r\n                    Log.e(\"ex\", e.getMessage());\r\n                }\r\n\r\n            }\r\n        });\r\n\r\n\r\n    }\r\n\r\n    private void getEveningList() {\r\n\r\n        HashMap<String, String> tempParam = new HashMap<>();\r\n\r\n\r\n        getSafeDriverServices.networkJsonRequestWithHeaders(this, tempParam, getString(R.string.BASE_URL) + getString(R.string.JOURNEY_LIST_MORNING), 1, tinyDB.getString(\"token\"), new VolleyJsonCallback() {\r\n\r\n            @Override\r\n            public void onSuccessResponse(JSONObject result) {\r\n\r\n                try {\r\n                    passengerList = new JSONArray();\r\n                    Log.e(\"response\", result + \"\");\r\n\r\n                    if (result.getBoolean(\"status\")) {\r\n\r\n                        passengerList = result.getJSONArray(\"models\");\r\n                        getPickupLatLong();\r\n                    } else\r\n                        showToast(dialog, result.getString(\"validation_errors\"), 0);\r\n\r\n\r\n                } catch (Exception e) {\r\n\r\n                    Log.e(\"ex\", e.getMessage());\r\n                }\r\n\r\n            }\r\n        });\r\n\r\n\r\n    }\r\n\r\n    private void notifyTripStart() {\r\n\r\n        HashMap<String, String> tempParam = new HashMap<>();\r\n\r\n        tempParam.put(\"latitude\", currentLat.toString());\r\n        tempParam.put(\"longitude\", currentLon.toString());\r\n        getSafeDriverServices.networkJsonRequestWithHeaders(this, tempParam, getString(R.string.BASE_URL) + getString(R.string.JOURNEY_START), 2, tinyDB.getString(\"token\"), new VolleyJsonCallback() {\r\n\r\n            @Override\r\n            public void onSuccessResponse(JSONObject result) {\r\n\r\n                try {\r\n\r\n                    if (result.getBoolean(\"status\")) {\r\n\r\n\r\n                    } else\r\n                        showToast(dialog, result.getString(\"validation_errors\"), 0);\r\n\r\n\r\n                } catch (Exception e) {\r\n\r\n                    Log.e(\"ex\", e.getMessage());\r\n                }\r\n\r\n            }\r\n        });\r\n\r\n\r\n    }\r\n\r\n    private void markAbsent(String id) {\r\n\r\n        HashMap<String, String> tempParam = new HashMap<>();\r\n        tempParam.put(\"id\", id);\r\n\r\n\r\n        getSafeDriverServices.networkJsonRequestWithHeaders(this, tempParam, getString(R.string.BASE_URL) + getString(R.string.MARK_PASSENGER_ABSENT), 2, tinyDB.getString(\"token\"), new VolleyJsonCallback() {\r\n\r\n            @Override\r\n            public void onSuccessResponse(JSONObject result) {\r\n\r\n                try {\r\n\r\n                    if (result.getBoolean(\"status\")) {\r\n\r\n\r\n                    } else\r\n                        showToast(dialog, result.getString(\"validation_errors\"), 0);\r\n\r\n\r\n                } catch (Exception e) {\r\n\r\n                    Log.e(\"ex\", e.getMessage());\r\n                }\r\n\r\n            }\r\n        });\r\n\r\n\r\n    }\r\n\r\n    private void pickUpPassenger(String id) {\r\n\r\n        HashMap<String, String> tempParam = new HashMap<>();\r\n        tempParam.put(\"id\", id);\r\n\r\n\r\n        getSafeDriverServices.networkJsonRequestWithHeaders(this, tempParam, getString(R.string.BASE_URL) + getString(R.string.PASSENGER_PICKUP), 2, tinyDB.getString(\"token\"), new VolleyJsonCallback() {\r\n\r\n            @Override\r\n            public void onSuccessResponse(JSONObject result) {\r\n\r\n                try {\r\n\r\n                    if (result.getBoolean(\"status\")) {\r\n\r\n\r\n                    } else\r\n                        showToast(dialog, result.getString(\"validation_errors\"), 0);\r\n\r\n\r\n                } catch (Exception e) {\r\n\r\n                    Log.e(\"ex\", e.getMessage());\r\n                }\r\n\r\n            }\r\n        });\r\n\r\n\r\n    }\r\n\r\n    private void dropOffPassenger(String id) {\r\n\r\n        HashMap<String, String> tempParam = new HashMap<>();\r\n        tempParam.put(\"id\", id);\r\n\r\n\r\n        getSafeDriverServices.networkJsonRequestWithHeaders(this, tempParam, getString(R.string.BASE_URL) + getString(R.string.PASSENGER_DROP), 3, tinyDB.getString(\"token\"), new VolleyJsonCallback() {\r\n\r\n            @Override\r\n            public void onSuccessResponse(JSONObject result) {\r\n\r\n                try {\r\n\r\n                    if (result.getBoolean(\"status\")) {\r\n\r\n\r\n                    } else\r\n                        showToast(dialog, result.getString(\"validation_errors\"), 0);\r\n\r\n\r\n                } catch (Exception e) {\r\n\r\n                    Log.e(\"ex\", e.getMessage());\r\n                }\r\n\r\n            }\r\n        });\r\n\r\n\r\n    }\r\n\r\n    private void notifyTripEnd() {\r\n\r\n        HashMap<String, String> tempParam = new HashMap<>();\r\n        tempParam.put(\"latitude\", currentLat.toString());\r\n        tempParam.put(\"longitude\", currentLon.toString());\r\n\r\n        getSafeDriverServices.networkJsonRequestWithHeaders(this, tempParam, getString(R.string.BASE_URL) + getString(R.string.JOURNEY_END), 2, tinyDB.getString(\"token\"), new VolleyJsonCallback() {\r\n\r\n            @Override\r\n            public void onSuccessResponse(JSONObject result) {\r\n\r\n                try {\r\n\r\n                    if (result.getBoolean(\"status\")) {\r\n\r\n\r\n                    } else\r\n                        showToast(dialog, result.getString(\"validation_errors\"), 0);\r\n\r\n\r\n                } catch (Exception e) {\r\n\r\n                    Log.e(\"ex\", e.getMessage());\r\n                }\r\n\r\n            }\r\n        });\r\n\r\n\r\n    }\r\n\r\n    private void informDriverArrival(String id) {\r\n\r\n        HashMap<String, String> tempParam = new HashMap<>();\r\n        tempParam.put(\"id\", id);\r\n\r\n\r\n        getSafeDriverServices.networkJsonRequestWithHeaders(this, tempParam, getString(R.string.BASE_URL) + getString(R.string.INFORM_DRIVER_ARRIVAL), 2, tinyDB.getString(\"token\"), new VolleyJsonCallback() {\r\n\r\n            @Override\r\n            public void onSuccessResponse(JSONObject result) {\r\n\r\n                try {\r\n\r\n                    if (result.getBoolean(\"status\")) {\r\n\r\n\r\n                    } else\r\n                        showToast(dialog, result.getString(\"validation_errors\"), 0);\r\n\r\n\r\n                } catch (Exception e) {\r\n\r\n                    Log.e(\"ex\", e.getMessage());\r\n                }\r\n\r\n            }\r\n        });\r\n\r\n\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/lk/hd192/getsafedriver/Map.java	(revision 357a9b0691f3a904196ae8b3f6f95a7b3825e28d)
+++ app/src/main/java/lk/hd192/getsafedriver/Map.java	(date 1616524014797)
@@ -77,14 +77,14 @@
     ArrayList<UserLocation> dropOffLocations = new ArrayList<>();
     LocationManager locationManager;
     GetSafeDriverServices getSafeDriverServices;
-    private DatabaseReference mRootRef, locationRef;
+    private DatabaseReference mRootRef, locationRef, driverId;
     String locationProvider = LocationManager.GPS_PROVIDER;
     CameraPosition cameraPosition;
     TextView txt_name, txt_distance, txt_time;
 
     String wayPoints;
     LinearLayout lnr_trip_details;
-TextView txt_error;
+    TextView txt_error;
     JSONArray passengerList;
     Polyline polyline;
     LocationListener locationListener;
@@ -129,13 +129,16 @@
 
         findViewById(R.id.btn_back).setOnClickListener(v -> onBackPressed());
 
-        tinyDB.putString("driver_id","5");
+        tinyDB.putString("driver_id", "5");
 
-        if (tinyDB.getBoolean("isStaffDriver"))
-            locationRef = mRootRef.child("Staff_Drivers").child(tinyDB.getString("driver_id")).child(tinyDB.getString("driver_id")).child("Location");
-        else
-            locationRef = mRootRef.child("School_Drivers").child(tinyDB.getString("driver_id")).child(tinyDB.getString("driver_id")).child("Location");
-
+        if (tinyDB.getBoolean("isStaffDriver")) {
+            locationRef = mRootRef.child("Staff_Drivers").child(tinyDB.getString("driver_id")).child("Location");
+            driverId = mRootRef.child("Staff_Drivers").child(tinyDB.getString("driver_id")).child("DriverId");
+        } else {
+            locationRef = mRootRef.child("School_Drivers").child(tinyDB.getString("driver_id")).child("Location");
+            driverId = mRootRef.child("School_Drivers").child(tinyDB.getString("driver_id")).child("DriverId");
+        }
+        driverId.setValue(tinyDB.getString("driver_id"));
 
         if (ActivityCompat.checkSelfPermission(Map.this, android.Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED && ActivityCompat.checkSelfPermission(Map.this, android.Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED) {
 
@@ -148,8 +151,8 @@
         originMarker = bitmapSizeByScale(BitmapFactory.decodeResource(getResources(), R.drawable.marker_passenger), 1);
         finalMarker = bitmapSizeByScale(BitmapFactory.decodeResource(getResources(), R.drawable.marker_end), 1);
 
-        currentLat = 6.965495959761049;
-        currentLon = 79.95475497680536;
+        currentLat = 6.906475002896019;
+        currentLon = 79.87047652139896;
 
 //        btnBack.setOnClickListener(new View.OnClickListener() {
 //            @Override
@@ -177,7 +180,7 @@
                         isPickingCompleted = true;
                 }
 
-                Log.e("trip status absent",isPickingCompleted+"");
+                Log.e("trip status absent", isPickingCompleted + "");
 
             }
         });
@@ -211,7 +214,7 @@
                     drawMapPolyline(new LatLng(currentLat, currentLon));
 
 
-                Log.e("trip status pick",isPickingCompleted+"");
+                Log.e("trip status pick", isPickingCompleted + "");
             }
         });
         btn_start_trip.setOnClickListener(new View.OnClickListener() {
@@ -228,7 +231,6 @@
                     tinyDB.putBoolean("isTripStart", true);
 
 
-
                     Log.e("drop offs", tinyDB.getListString("tripRoute") + "");
                     btn_start_trip.setBackground(getResources().getDrawable(R.drawable.bg_btn_stop));
                     if (timeOfDay >= 0 && timeOfDay < 12) {
@@ -274,11 +276,19 @@
 //                locationRef.child("latitude").setValue(location.getLatitude());
 //                locationRef.child("longitude").setValue(location.getLongitude());
                 // pushId++;
+                currentLat = location.getLatitude();
+                currentLon = location.getLongitude();
+
+
+                Log.e("curnt loc", currentLat.toString());
+
                 java.util.Map messageMap = new HashMap();
-                messageMap.put("latitude", location.getLatitude());
-                messageMap.put("longitude", location.getLongitude());
+                messageMap.put("latitude", currentLat);
+                messageMap.put("longitude", currentLon);
                 messageMap.put("status", btn_start_trip.getText().toString());
+                googleMap.clear();
 
+                drawMapPolyline(new LatLng(currentLat, currentLon));
 
                 locationRef.updateChildren(messageMap, new DatabaseReference.CompletionListener() {
                     @Override
@@ -332,9 +342,7 @@
                     LocationUpdates locationUpdates = snapshot.getValue(LocationUpdates.class);
                     currentLat = locationUpdates.getLatitude();
                     currentLon = locationUpdates.getLongitude();
-                    googleMap.clear();
 
-                    drawMapPolyline(new LatLng(currentLat, currentLon));
                 } catch (Exception e) {
                     e.printStackTrace();
                 }
@@ -347,8 +355,6 @@
         });
 
 
-
-
         try {
 
             MapsInitializer.initialize(getApplicationContext());
@@ -377,10 +383,10 @@
         super.onResume();
         if (tinyDB.getBoolean("isTripStart")) {
 
-//            btn_start_trip.setBackground(getResources().getDrawable(R.drawable.bg_btn_stop));
-//            btn_start_trip.setText("End Trip");
-//            txt_error.setVisibility(View.GONE);
-//            lnr_trip_details.setVisibility(View.VISIBLE);
+            btn_start_trip.setBackground(getResources().getDrawable(R.drawable.bg_btn_stop));
+            btn_start_trip.setText("End Trip");
+            txt_error.setVisibility(View.GONE);
+            lnr_trip_details.setVisibility(View.VISIBLE);
 //            dropOffLocations = new ArrayList<>();
 ////            for (String s :  tinyDB.getListString("tripRoute")) {
 //////                Object o=s;
@@ -394,8 +400,7 @@
 //            drawMapPolyline(new LatLng(currentLat, currentLon));
 
 
-        }
-        else{
+        } else {
 
             txt_error.setVisibility(View.VISIBLE);
             lnr_trip_details.setVisibility(View.GONE);
@@ -555,7 +560,7 @@
 //    }
 
     public void drawMapPolyline(LatLng origin) {
-        Log.e("draw polyline","exe");
+        Log.e("draw polyline", "exe");
         try {
 
             for (int f = 0; f < distance.size(); f++) {
@@ -675,10 +680,9 @@
 
                 downloadTask.execute(url);
             }
-        }
-        catch (Exception e){
-            Log.e("ez",e.getMessage());
-         e.printStackTrace();
+        } catch (Exception e) {
+            Log.e("ez", e.getMessage());
+            e.printStackTrace();
         }
 
     }
@@ -901,7 +905,7 @@
 
     void getPickupLatLong() {
         try {
-            Log.e("getPickupLatLong","exe");
+            Log.e("getPickupLatLong", "exe");
             for (int jk = 0; jk < passengerList.length(); jk++) {
 
                 dropOffLocations.add(jk, new UserLocation(passengerList.getJSONObject(jk).getString("id"), passengerList.getJSONObject(jk).getString("name"), passengerList.getJSONObject(jk).getJSONObject("location").getDouble("pick_up_latitude"), passengerList.getJSONObject(jk).getJSONObject("location").getDouble("pick_up_longitude"), passengerList.getJSONObject(jk).getJSONObject("location").getDouble("drop_off_latitude"), passengerList.getJSONObject(jk).getJSONObject("location").getDouble("drop_off_longitude"), calculateDistance(currentLat, currentLon, passengerList.getJSONObject(jk).getJSONObject("location").getDouble("pick_up_latitude"), passengerList.getJSONObject(jk).getJSONObject("location").getDouble("pick_up_longitude")), false, false, false));
Index: app/src/main/java/lk/hd192/getsafedriver/AddDriverFourth.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package lk.hd192.getsafedriver;\r\n\r\nimport android.app.Dialog;\r\nimport android.content.Intent;\r\nimport android.graphics.Bitmap;\r\nimport android.graphics.BitmapFactory;\r\nimport android.graphics.Color;\r\nimport android.graphics.drawable.Drawable;\r\nimport android.net.Uri;\r\nimport android.os.Bundle;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.annotation.Nullable;\r\nimport androidx.fragment.app.Fragment;\r\n\r\nimport android.util.Base64;\r\nimport android.util.Log;\r\nimport android.view.LayoutInflater;\r\nimport android.view.View;\r\nimport android.view.ViewGroup;\r\nimport android.widget.ImageView;\r\nimport android.widget.Toast;\r\n\r\n\r\nimport com.bumptech.glide.load.engine.Resource;\r\nimport com.shreyaspatil.MaterialDialog.BottomSheetMaterialDialog;\r\nimport com.shreyaspatil.MaterialDialog.interfaces.DialogInterface;\r\nimport com.vlk.multimager.activities.GalleryActivity;\r\nimport com.vlk.multimager.activities.MultiCameraActivity;\r\nimport com.vlk.multimager.utils.Constants;\r\nimport com.vlk.multimager.utils.Image;\r\nimport com.vlk.multimager.utils.Params;\r\n\r\nimport org.json.JSONException;\r\nimport org.json.JSONObject;\r\n\r\nimport java.io.ByteArrayOutputStream;\r\nimport java.io.File;\r\nimport java.io.FileInputStream;\r\nimport java.io.FileNotFoundException;\r\nimport java.io.FileWriter;\r\nimport java.io.IOException;\r\nimport java.io.OutputStreamWriter;\r\nimport java.util.ArrayList;\r\nimport java.util.HashMap;\r\nimport java.util.List;\r\n\r\nimport lk.hd192.getsafedriver.Utils.GetSafeDriverBaseFragment;\r\nimport lk.hd192.getsafedriver.Utils.GetSafeDriverServices;\r\nimport lk.hd192.getsafedriver.Utils.TinyDB;\r\nimport lk.hd192.getsafedriver.Utils.VolleyJsonCallback;\r\n\r\nimport static android.Manifest.permission.READ_EXTERNAL_STORAGE;\r\nimport static android.Manifest.permission.WRITE_EXTERNAL_STORAGE;\r\nimport static android.app.Activity.RESULT_OK;\r\n\r\npublic class AddDriverFourth extends GetSafeDriverBaseFragment {\r\n\r\n    public ImageView imageDriver, imgLicOne, imgLicTwo, imgIdOne, imgIdTwo, img_vehicle_one, img_vehicle_three, img_vehicle_four, img_vehicle_two;\r\n    List<Image> imagesList;\r\n    ArrayList<String> imagesBase64;\r\n    Image[] imagesToUpload = new Image[9];\r\n    TinyDB tinyDB;\r\n    Dialog dialog;\r\n\r\n    GetSafeDriverServices getSafeDriverServices;\r\n    Boolean fromIdOne = false, fromIdTwo = false, fromLicOne = false, fromLicTwo = false, fromDriverPic = false, fromVehicleOne = false, fromVehicleTwo = false, fromVehicleThree = false, fromVehicleOneFour = false;\r\n\r\n    public AddDriverFourth() {\r\n        // Required empty public constructor\r\n    }\r\n\r\n\r\n    @Override\r\n    public void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n\r\n    }\r\n\r\n    @Override\r\n    public View onCreateView(LayoutInflater inflater, ViewGroup container,\r\n                             Bundle savedInstanceState) {\r\n        // Inflate the layout for this fragment\r\n        return inflater.inflate(R.layout.fragment_add_driver_fourth, container, false);\r\n    }\r\n\r\n    @Override\r\n    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {\r\n        super.onViewCreated(view, savedInstanceState);\r\n        tinyDB = new TinyDB(getActivity());\r\n        getSafeDriverServices = new GetSafeDriverServices();\r\n        imageDriver = view.findViewById(R.id.image_driver);\r\n        imgLicTwo = view.findViewById(R.id.img_lic_two);\r\n        imgLicOne = view.findViewById(R.id.img_lic_one);\r\n        imgIdOne = view.findViewById(R.id.img_id_one);\r\n        imgIdTwo = view.findViewById(R.id.img_id_two);\r\n        img_vehicle_three = view.findViewById(R.id.img_vehicle_three);\r\n        img_vehicle_one = view.findViewById(R.id.img_vehicle_one);\r\n        img_vehicle_two = view.findViewById(R.id.img_vehicle_two);\r\n        img_vehicle_four = view.findViewById(R.id.img_vehicle_four);\r\n\r\n        imagesList = new ArrayList<>();\r\n        imagesBase64 = new ArrayList<>();\r\n\r\n        dialog = new Dialog(getActivity(), android.R.style.Theme_Translucent_NoTitleBar_Fullscreen);\r\n\r\n        imageDriver.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                fromDriverPic = true;\r\n                openGallery(1);\r\n\r\n            }\r\n        });\r\n\r\n        imgLicTwo.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                fromLicTwo = true;\r\n                openGallery(2);\r\n\r\n            }\r\n        });\r\n        imgIdTwo.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                fromIdTwo = true;\r\n                openGallery(2);\r\n\r\n            }\r\n        });\r\n        imgLicOne.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                fromLicOne = true;\r\n                openGallery(2);\r\n\r\n\r\n            }\r\n        });\r\n        imgIdOne.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                fromIdOne = true;\r\n                openGallery(2);\r\n\r\n            }\r\n        });\r\n        img_vehicle_four.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                fromVehicleOne = true;\r\n                openGallery(4);\r\n\r\n            }\r\n        });\r\n        img_vehicle_three.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                fromVehicleOne = true;\r\n                openGallery(4);\r\n\r\n            }\r\n        });\r\n        img_vehicle_two.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                fromVehicleOne = true;\r\n                openGallery(4);\r\n\r\n            }\r\n        });\r\n        img_vehicle_one.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                fromVehicleOne = true;\r\n                openGallery(4);\r\n\r\n\r\n            }\r\n        });\r\n    }\r\n\r\n//    void openPickerDialog(int limit){\r\n//        BottomSheetMaterialDialog mBottomSheetDialog = new BottomSheetMaterialDialog.Builder(getActivity())\r\n//                .setTitle(\"Pick Image\")\r\n//                .setMessage(\"Select image source\")\r\n//                .setCancelable(false)\r\n//                .setPositiveButton(\"Gallery\", R.drawable.ic_insert_photo_black_48dp, new BottomSheetMaterialDialog.OnClickListener() {\r\n//                    @Override\r\n//                    public void onClick(DialogInterface dialogInterface, int which) {\r\n//\r\n//                        dialogInterface.dismiss();\r\n//                        openGallery(limit);\r\n//                    }\r\n//                })\r\n//                .setNegativeButton(\"Camera\", R.drawable.ic_camera_menu, new BottomSheetMaterialDialog.OnClickListener() {\r\n//                    @Override\r\n//                    public void onClick(DialogInterface dialogInterface, int which) {\r\n//\r\n//                        dialogInterface.dismiss();\r\n//                        openCamera(limit);\r\n//                    }\r\n//                })\r\n//                .build();\r\n//\r\n//        // Show Dialog\r\n//        mBottomSheetDialog.show();\r\n//\r\n//    }\r\n\r\n    void openGallery(int limit) {\r\n        Intent intent = new Intent(getActivity(), GalleryActivity.class);\r\n        Params params = new Params();\r\n        params.setCaptureLimit(limit);\r\n        params.setPickerLimit(limit);\r\n        params.setToolbarColor(R.color.statusBarColor);\r\n        params.setActionButtonColor(R.color.statusBarColor);\r\n        params.setButtonTextColor(R.color.statusBarColor);\r\n        intent.putExtra(Constants.KEY_PARAMS, params);\r\n        startActivityForResult(intent, Constants.TYPE_MULTI_PICKER);\r\n\r\n    }\r\n\r\n    @Override\r\n    public void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {\r\n        super.onActivityResult(requestCode, resultCode, data);\r\n        Log.e(\"frag onActivityResult\", data + \"\");\r\n        if (resultCode != RESULT_OK) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n\r\n            imagesList = data.getParcelableArrayListExtra(Constants.KEY_BUNDLE_LIST);\r\n            if (fromDriverPic) {\r\n                imageDriver.setImageURI(imagesList.get(0).uri);\r\n//                encodeImage(imagesList.get(0).imagePath);\r\n                fromDriverPic = false;\r\n\r\n                imagesToUpload[0] = imagesList.get(0);\r\n                Log.e(\"1 imagesToUpload\", imagesToUpload.length + \"\");\r\n                imagesList.clear();\r\n\r\n\r\n            } else if (fromIdTwo || fromIdOne) {\r\n                if (imagesList.size() == 2) {\r\n                    imgIdOne.setImageURI(imagesList.get(0).uri);\r\n                    imgIdTwo.setImageURI(imagesList.get(1).uri);\r\n                    if (fromIdTwo) fromIdTwo = false;\r\n                    else if (fromIdOne) fromIdOne = false;\r\n\r\n                    imagesToUpload[1] = imagesList.get(0);\r\n                    imagesToUpload[2] = imagesList.get(1);\r\n\r\n                } else if (fromIdOne) {\r\n                    imgIdOne.setImageURI(imagesList.get(0).uri);\r\n\r\n                    imagesToUpload[1] = imagesList.get(0);\r\n\r\n                    fromIdOne = false;\r\n                } else if (fromIdTwo) {\r\n\r\n                    imgIdTwo.setImageURI(imagesList.get(0).uri);\r\n                    fromIdTwo = false;\r\n                    imagesToUpload[2] = imagesList.get(0);\r\n\r\n                }\r\n\r\n//                    imgIdOne.setImageURI(imagesList.get(0).uri);\r\n\r\n\r\n                imagesList.clear();\r\n            } else if (fromLicTwo || fromLicOne) {\r\n                if (imagesList.size() == 2) {\r\n                    imgLicOne.setImageURI(imagesList.get(0).uri);\r\n                    imgLicTwo.setImageURI(imagesList.get(1).uri);\r\n                    if (fromLicOne) fromLicOne = false;\r\n                    else if (fromLicTwo) fromLicTwo = false;\r\n\r\n\r\n                    imagesToUpload[3] = imagesList.get(0);\r\n                    imagesToUpload[4] = imagesList.get(1);\r\n                } else if (fromLicOne) {\r\n                    imgLicOne.setImageURI(imagesList.get(0).uri);\r\n                    fromLicOne = false;\r\n\r\n                    imagesToUpload[3] = imagesList.get(0);\r\n                } else if (fromLicTwo) {\r\n                    imgLicTwo.setImageURI(imagesList.get(0).uri);\r\n                    fromLicTwo = false;\r\n\r\n                    imagesToUpload[4] = imagesList.get(0);\r\n\r\n                }\r\n\r\n                imagesList.clear();\r\n            } else if (fromVehicleOne) {\r\n\r\n\r\n                if (imagesList.size() == 4) {\r\n\r\n                    img_vehicle_one.setImageURI(imagesList.get(0).uri);\r\n                    img_vehicle_three.setImageURI(imagesList.get(2).uri);\r\n                    img_vehicle_two.setImageURI(imagesList.get(1).uri);\r\n                    img_vehicle_four.setImageURI(imagesList.get(3).uri);\r\n\r\n                    imagesToUpload[5] = imagesList.get(0);\r\n                    imagesToUpload[6] = imagesList.get(1);\r\n                    imagesToUpload[7] = imagesList.get(2);\r\n                    imagesToUpload[8] = imagesList.get(3);\r\n                    fromVehicleOne = false;\r\n                    imagesList.clear();\r\n                } else\r\n                    showToast(dialog, \"Select at least 4 photos\", 0);\r\n\r\n\r\n            }\r\n\r\n\r\n        } catch (\r\n                Exception e) {\r\n            e.printStackTrace();\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n    public interface LoadingCall {\r\n\r\n        void showLoadingImage();\r\n\r\n        void hideLoadingImage();\r\n\r\n    }\r\n\r\n    private String encodeImage(String path) throws IOException {\r\n//        requestPermissions(new String[]{WRITE_EXTERNAL_STORAGE,READ_EXTERNAL_STORAGE}, 1);\r\n        File imagefile = new File(path);\r\n\r\n        FileInputStream fis = null;\r\n        try {\r\n            fis = new FileInputStream(imagefile);\r\n        } catch (FileNotFoundException e) {\r\n            e.printStackTrace();\r\n        }\r\n        Bitmap bm = BitmapFactory.decodeStream(fis);\r\n        ByteArrayOutputStream baos = new ByteArrayOutputStream();\r\n        bm.compress(Bitmap.CompressFormat.JPEG, 100, baos);\r\n        byte[] b = baos.toByteArray();\r\n        String encImage = Base64.encodeToString(b, Base64.DEFAULT);\r\n\r\n\r\n//        outputStreamWriter.close();\r\n        //Base64.de\r\n        return \"data:image/jpeg;base64,\" + encImage;\r\n\r\n    }\r\n\r\n    public void convertToBase64AndUpload() throws IOException {\r\n        boolean validated = true;\r\n        ((LoadingCall) getActivity()).showLoadingImage();\r\n//\r\n        for (Image image : imagesToUpload) {\r\n            if (image == null) {\r\n                ((LoadingCall) getActivity()).hideLoadingImage();\r\n                showToast(dialog, \"Please add all photos\", 0);\r\n                validated = false;\r\n                break;\r\n            } else {\r\n\r\n\r\n            }\r\n        }\r\n        if (validated) {\r\n            Log.e(\"validated \", \"ok\");\r\n            for (int g = 0; g < imagesToUpload.length; g++) {\r\n\r\n                imagesBase64.add(g, encodeImage(imagesToUpload[g].imagePath));\r\n            }\r\n            addDriverImage();\r\n            addDriverIdFront();\r\n            addDriverIdBack();\r\n            addDriverLicence();\r\n            addVehicleImages();\r\n//            ((LoadingCall) getActivity()).hideLoadingImage();\r\n        }\r\n\r\n\r\n    }\r\n\r\n    private void addDriverImage() {\r\n        Log.e(\"addDriverImage\", \"exe\");\r\n\r\n        HashMap<String, String> tempParam = new HashMap<>();\r\n        tempParam.put(\"id\", tinyDB.getString(\"driver_id\"));\r\n        tempParam.put(\"image\", imagesBase64.get(0));\r\n\r\n\r\n        getSafeDriverServices.networkJsonRequestWithoutHeader(getActivity(), tempParam, getString(R.string.BASE_URL) + getString(R.string.DRIVER_IMAGE), 2, new VolleyJsonCallback() {\r\n            @Override\r\n            public void onSuccessResponse(JSONObject result) {\r\n\r\n                try {\r\n\r\n                    if (result.getBoolean(\"saved_status\")) {\r\n\r\n                    } else ((LoadingCall) getActivity()).hideLoadingImage();\r\n\r\n                } catch (JSONException ex) {\r\n                    ex.printStackTrace();\r\n                }\r\n\r\n\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    private void addDriverIdFront() {\r\n\r\n        Log.e(\"addDriverIdFront\", \"exe\");\r\n        HashMap<String, String> tempParam = new HashMap<>();\r\n        tempParam.put(\"id\", tinyDB.getString(\"driver_id\"));\r\n        tempParam.put(\"image\", imagesBase64.get(1));\r\n\r\n        getSafeDriverServices.networkJsonRequestWithoutHeader(getActivity(), tempParam, getString(R.string.BASE_URL) + getString(R.string.DRIVER_IMAGE), 2, new VolleyJsonCallback() {\r\n            @Override\r\n            public void onSuccessResponse(JSONObject result) {\r\n\r\n                try {\r\n                    Log.e(\"res addDriverIdFront\", result + \"\");\r\n\r\n                    if (result.getBoolean(\"saved_status\")) {\r\n\r\n                    } else ((LoadingCall) getActivity()).hideLoadingImage();\r\n\r\n\r\n                } catch (JSONException ex) {\r\n                    ex.printStackTrace();\r\n                }\r\n\r\n\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    private void addDriverIdBack() {\r\n\r\n        Log.e(\"addDriverIdBack\", \"exe\");\r\n        HashMap<String, String> tempParam = new HashMap<>();\r\n        tempParam.put(\"id\", tinyDB.getString(\"driver_id\"));\r\n        tempParam.put(\"image\", imagesBase64.get(2));\r\n\r\n        ((LoadingCall) getActivity()).showLoadingImage();\r\n        getSafeDriverServices.networkJsonRequestWithoutHeader(getActivity(), tempParam, getString(R.string.BASE_URL) + getString(R.string.DRIVER_NIC_BACK), 2, new VolleyJsonCallback() {\r\n            @Override\r\n            public void onSuccessResponse(JSONObject result) {\r\n\r\n                try {\r\n                    Log.e(\"res addDriverIdBack\", result + \"\");\r\n                    if (result.getBoolean(\"saved_status\")) {\r\n\r\n                    } else ((LoadingCall) getActivity()).hideLoadingImage();\r\n\r\n                } catch (JSONException ex) {\r\n                    ex.printStackTrace();\r\n                }\r\n\r\n\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    private void addDriverLicence() {\r\n\r\n        Log.e(\"addDriverLicence\", \"exe\");\r\n\r\n        HashMap<String, String> tempParam = new HashMap<>();\r\n        tempParam.put(\"id\", tinyDB.getString(\"driver_id\"));\r\n        tempParam.put(\"image\", imagesBase64.get(3));\r\n\r\n\r\n        getSafeDriverServices.networkJsonRequestWithoutHeader(getActivity(), tempParam, getString(R.string.BASE_URL) + getString(R.string.DRIVER_LICENCE), 2, new VolleyJsonCallback() {\r\n            @Override\r\n            public void onSuccessResponse(JSONObject result) {\r\n\r\n                try {\r\n                    Log.e(\"res addDriverLicence\", result + \"\");\r\n                    if (result.getBoolean(\"saved_status\")) {\r\n\r\n                    } else ((LoadingCall) getActivity()).hideLoadingImage();\r\n\r\n\r\n                } catch (JSONException ex) {\r\n                    ex.printStackTrace();\r\n                }\r\n\r\n\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    private void addVehicleImages() {\r\n\r\n        Log.e(\"addDriverLicence\", \"exe\");\r\n\r\n        HashMap<String, String> tempParam = new HashMap<>();\r\n        tempParam.put(\"id\", tinyDB.getString(\"driver_id\"));\r\n        tempParam.put(\"image1\", imagesBase64.get(5));\r\n        tempParam.put(\"image2\", imagesBase64.get(6));\r\n        tempParam.put(\"image3\", imagesBase64.get(7));\r\n        tempParam.put(\"image4\", imagesBase64.get(8));\r\n        tempParam.put(\"image5\", imagesBase64.get(8));\r\n\r\n\r\n        getSafeDriverServices.networkJsonRequestWithoutHeader(getActivity(), tempParam, getString(R.string.BASE_URL) + getString(R.string.DRIVER_VEHICLE_IMAGES), 2, new VolleyJsonCallback() {\r\n            @Override\r\n            public void onSuccessResponse(JSONObject result) {\r\n\r\n                try {\r\n                    Log.e(\"res addDriverLicence\", result + \"\");\r\n                    if (result.getBoolean(\"saved_status\")) {\r\n                        ((LoadingCall) getActivity()).hideLoadingImage();\r\n                        showToast(dialog, \"Registration Completed. Please login\", 2);\r\n                        startActivity(new Intent(getActivity(), Login.class));\r\n                        getActivity().finishAffinity();\r\n\r\n                    } else ((LoadingCall) getActivity()).hideLoadingImage();\r\n\r\n\r\n                } catch (JSONException ex) {\r\n                    ex.printStackTrace();\r\n                }\r\n\r\n\r\n            }\r\n        });\r\n        ((LoadingCall) getActivity()).hideLoadingImage();\r\n    }\r\n\r\n\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/lk/hd192/getsafedriver/AddDriverFourth.java	(revision 357a9b0691f3a904196ae8b3f6f95a7b3825e28d)
+++ app/src/main/java/lk/hd192/getsafedriver/AddDriverFourth.java	(date 1616520780514)
@@ -515,7 +515,7 @@
         tempParam.put("image2", imagesBase64.get(6));
         tempParam.put("image3", imagesBase64.get(7));
         tempParam.put("image4", imagesBase64.get(8));
-        tempParam.put("image5", imagesBase64.get(8));
+//        tempParam.put("image5", imagesBase64.get(8));
 
 
         getSafeDriverServices.networkJsonRequestWithoutHeader(getActivity(), tempParam, getString(R.string.BASE_URL) + getString(R.string.DRIVER_VEHICLE_IMAGES), 2, new VolleyJsonCallback() {
Index: app/src/main/res/layout/fragment_add_driver_first.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<FrameLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:focusableInTouchMode=\"true\"\r\n    android:layout_height=\"match_parent\"\r\n    tools:context=\".AddDriverFirst\">\r\n\r\n    <ScrollView\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"match_parent\"\r\n        android:layout_below=\"@id/lnr_image\"\r\n        android:clipToPadding=\"false\"\r\n        android:overScrollMode=\"never\"\r\n        android:paddingBottom=\"60dp\"\r\n        android:scrollbars=\"none\">\r\n\r\n        <RelativeLayout\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"match_parent\"\r\n            android:clipToPadding=\"false\">\r\n\r\n\r\n            <LinearLayout\r\n                android:id=\"@+id/name_main\"\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"match_parent\"\r\n                android:layout_marginLeft=\"15dp\"\r\n                android:layout_marginTop=\"15dp\"\r\n                android:layout_marginRight=\"15dp\">\r\n\r\n\r\n                <LinearLayout\r\n                    android:layout_width=\"match_parent\"\r\n                    android:layout_height=\"match_parent\"\r\n                    android:orientation=\"vertical\">\r\n\r\n\r\n                    <LinearLayout\r\n                        android:layout_width=\"match_parent\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:layout_marginTop=\"10dp\"\r\n                        android:orientation=\"horizontal\">\r\n\r\n                        <LinearLayout\r\n                            android:layout_width=\"0dp\"\r\n                            android:layout_height=\"wrap_content\"\r\n                            android:layout_weight=\"6\"\r\n                            android:orientation=\"vertical\">\r\n\r\n                            <TextView\r\n\r\n                                android:layout_width=\"match_parent\"\r\n                                android:layout_height=\"20dp\"\r\n                                android:fontFamily=\"@font/nunito_regular\"\r\n                                android:gravity=\"center_vertical\"\r\n                                android:hint=\"Your Name\"\r\n                                android:textColor=\"@color/black\"\r\n                                android:textSize=\"14sp\" />\r\n\r\n\r\n                            <com.libizo.CustomEditText\r\n                                android:id=\"@+id/edit_txt_name\"\r\n                                android:layout_width=\"match_parent\"\r\n                                android:layout_height=\"match_parent\"\r\n\r\n                                android:layout_marginTop=\"10dp\"\r\n                                android:fontFamily=\"@font/nunito_bold\"\r\n                                android:imeOptions=\"actionDone\"\r\n                                android:paddingHorizontal=\"10dp\"\r\n                                android:paddingVertical=\"5dp\"\r\n                                android:singleLine=\"true\"\r\n                                android:textColor=\"@color/black\"\r\n                                android:textSize=\"18sp\"\r\n                                app:libIZO_clearIconTint=\"#8f1f15\"\r\n\r\n\r\n                                app:libIZO_setBorderColor=\"#A37C07\"\r\n                                app:libIZO_setBorderView=\"true\"\r\n                                app:libIZO_setClearIconVisible=\"true\"\r\n\r\n                                app:libIZO_setCornerRadius=\"4dp\"\r\n                                app:libIZO_setStrokeWidth=\"1dp\" />\r\n\r\n\r\n                        </LinearLayout>\r\n\r\n                        <RelativeLayout\r\n                            android:layout_width=\"0dp\"\r\n                            android:layout_height=\"match_parent\"\r\n                            android:layout_weight=\"1\">\r\n\r\n                            <TextView\r\n                                android:id=\"@+id/txt_tel_edit_indicator\"\r\n                                android:layout_width=\"match_parent\"\r\n                                android:layout_height=\"40dp\"\r\n                                android:layout_centerInParent=\"true\"\r\n                                android:gravity=\"center\"\r\n\r\n                                android:text=\"Edited\"\r\n                                android:visibility=\"invisible\" />\r\n\r\n                        </RelativeLayout>\r\n\r\n\r\n                    </LinearLayout>\r\n\r\n\r\n                </LinearLayout>\r\n\r\n\r\n            </LinearLayout>\r\n\r\n            <LinearLayout\r\n                android:id=\"@+id/nic_main\"\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"match_parent\"\r\n                android:layout_below=\"@+id/name_main\"\r\n                android:layout_marginLeft=\"15dp\"\r\n                android:layout_marginTop=\"15dp\"\r\n                android:layout_marginRight=\"15dp\">\r\n\r\n\r\n                <LinearLayout\r\n                    android:layout_width=\"match_parent\"\r\n                    android:layout_height=\"match_parent\"\r\n                    android:orientation=\"vertical\">\r\n\r\n\r\n                    <LinearLayout\r\n                        android:layout_width=\"match_parent\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:layout_marginTop=\"5dp\"\r\n                        android:orientation=\"horizontal\">\r\n\r\n                        <LinearLayout\r\n                            android:layout_width=\"0dp\"\r\n                            android:layout_height=\"wrap_content\"\r\n                            android:layout_weight=\"6\"\r\n                            android:orientation=\"vertical\">\r\n\r\n                            <TextView\r\n\r\n                                android:layout_width=\"match_parent\"\r\n                                android:layout_height=\"20dp\"\r\n                                android:fontFamily=\"@font/nunito_regular\"\r\n                                android:gravity=\"center_vertical\"\r\n                                android:hint=\"National Identity Card No\"\r\n                                android:textColor=\"@color/black\"\r\n                                android:textSize=\"14sp\" />\r\n\r\n\r\n                            <com.libizo.CustomEditText\r\n                                android:id=\"@+id/edit_txt_nic\"\r\n                                android:layout_width=\"match_parent\"\r\n                                android:layout_height=\"match_parent\"\r\n\r\n                                android:layout_marginTop=\"10dp\"\r\n                                android:fontFamily=\"@font/nunito_bold\"\r\n                                android:imeOptions=\"actionDone\"\r\n                                android:paddingHorizontal=\"10dp\"\r\n                                android:paddingVertical=\"5dp\"\r\n                                android:singleLine=\"true\"\r\n                                android:textColor=\"@color/black\"\r\n                                android:textSize=\"18sp\"\r\n                                android:maxLength=\"12\"\r\n                                app:libIZO_clearIconTint=\"#8f1f15\"\r\n                                app:libIZO_setBorderColor=\"#A37C07\"\r\n                                app:libIZO_setBorderView=\"true\"\r\n\r\n                                app:libIZO_setClearIconVisible=\"true\"\r\n\r\n                                app:libIZO_setCornerRadius=\"4dp\"\r\n                                app:libIZO_setStrokeWidth=\"1dp\" />\r\n\r\n                        </LinearLayout>\r\n\r\n                        <RelativeLayout\r\n                            android:layout_width=\"0dp\"\r\n                            android:layout_height=\"match_parent\"\r\n                            android:layout_weight=\"1\">\r\n\r\n                            <TextView\r\n                                android:id=\"@+id/txt_email_edit_indicator\"\r\n                                android:layout_width=\"match_parent\"\r\n                                android:layout_height=\"40dp\"\r\n                                android:layout_centerInParent=\"true\"\r\n                                android:gravity=\"center\"\r\n\r\n                                android:text=\"Edited\"\r\n                                android:visibility=\"invisible\" />\r\n\r\n                        </RelativeLayout>\r\n\r\n\r\n                    </LinearLayout>\r\n\r\n\r\n                </LinearLayout>\r\n\r\n\r\n            </LinearLayout>\r\n\r\n            <LinearLayout\r\n                android:id=\"@+id/license_no_main\"\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"match_parent\"\r\n                android:layout_below=\"@+id/nic_main\"\r\n                android:layout_marginLeft=\"15dp\"\r\n                android:layout_marginTop=\"15dp\"\r\n                android:layout_marginRight=\"15dp\">\r\n\r\n\r\n                <LinearLayout\r\n                    android:layout_width=\"match_parent\"\r\n                    android:layout_height=\"match_parent\"\r\n                    android:orientation=\"vertical\">\r\n\r\n                    <LinearLayout\r\n                        android:layout_width=\"match_parent\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:layout_marginTop=\"5dp\"\r\n                        android:orientation=\"horizontal\">\r\n\r\n                        <LinearLayout\r\n                            android:id=\"@+id/lnr_license_no_main\"\r\n                            android:layout_width=\"0dp\"\r\n                            android:layout_height=\"wrap_content\"\r\n                            android:layout_weight=\"6\"\r\n                            android:orientation=\"vertical\">\r\n\r\n                            <TextView\r\n\r\n                                android:layout_width=\"match_parent\"\r\n                                android:layout_height=\"20dp\"\r\n                                android:fontFamily=\"@font/nunito_regular\"\r\n                                android:gravity=\"center_vertical\"\r\n                                android:hint=\"Driver's License No\"\r\n                                android:textColor=\"@color/black\"\r\n                                android:textSize=\"14sp\" />\r\n\r\n                            <com.libizo.CustomEditText\r\n                                android:id=\"@+id/edit_text_license_no_main\"\r\n                                android:layout_width=\"match_parent\"\r\n                                android:layout_height=\"match_parent\"\r\n                                android:layout_marginTop=\"10dp\"\r\n                                android:fontFamily=\"@font/nunito_semibold\"\r\n                                android:textColor=\"@color/black\"\r\n                                android:textSize=\"18sp\"\r\n                                android:maxLength=\"8\"\r\n                                app:libIZO_clearIconTint=\"#8f1f15\"\r\n                                app:libIZO_setBorderColor=\"#A37C07\"\r\n                                app:libIZO_setBorderView=\"true\"\r\n                                app:libIZO_setClearIconVisible=\"true\"\r\n                                app:libIZO_setCornerRadius=\"4dp\"\r\n                                app:libIZO_setStrokeWidth=\"1dp\" />\r\n\r\n                        </LinearLayout>\r\n\r\n                        <RelativeLayout\r\n                            android:layout_width=\"0dp\"\r\n                            android:layout_height=\"match_parent\"\r\n                            android:layout_weight=\"1\">\r\n\r\n                            <ImageView\r\n                                android:id=\"@+id/img_loc_edit_indicator\"\r\n                                android:layout_width=\"30dp\"\r\n                                android:layout_height=\"30dp\"\r\n                                android:layout_centerInParent=\"true\"\r\n                                android:gravity=\"center\"\r\n\r\n\r\n                                android:visibility=\"invisible\" />\r\n                        </RelativeLayout>\r\n\r\n\r\n                    </LinearLayout>\r\n\r\n\r\n                </LinearLayout>\r\n\r\n\r\n            </LinearLayout>\r\n\r\n\r\n            <LinearLayout\r\n                android:id=\"@+id/telephone_main\"\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"match_parent\"\r\n                android:layout_below=\"@+id/license_no_main\"\r\n                android:layout_marginLeft=\"15dp\"\r\n                android:layout_marginTop=\"15dp\"\r\n                android:layout_marginRight=\"15dp\">\r\n\r\n\r\n                <LinearLayout\r\n                    android:layout_width=\"match_parent\"\r\n                    android:layout_height=\"match_parent\"\r\n                    android:orientation=\"vertical\">\r\n\r\n\r\n                    <LinearLayout\r\n                        android:layout_width=\"match_parent\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:layout_marginTop=\"5dp\"\r\n                        android:orientation=\"horizontal\">\r\n\r\n                        <LinearLayout\r\n                            android:id=\"@+id/lnr_telephone\"\r\n                            android:layout_width=\"0dp\"\r\n                            android:layout_height=\"wrap_content\"\r\n                            android:layout_weight=\"6\"\r\n                            android:orientation=\"vertical\">\r\n\r\n                            <TextView\r\n\r\n                                android:layout_width=\"match_parent\"\r\n                                android:layout_height=\"20dp\"\r\n                                android:fontFamily=\"@font/nunito_regular\"\r\n                                android:gravity=\"center_vertical\"\r\n                                android:hint=\"Telephone Number\"\r\n                                android:textColor=\"@color/black\"\r\n                                android:textSize=\"14sp\" />\r\n\r\n                            <com.libizo.CustomEditText\r\n                                android:id=\"@+id/edit_text_telephone\"\r\n                                android:layout_width=\"match_parent\"\r\n                                android:layout_height=\"match_parent\"\r\n                                android:layout_marginTop=\"10dp\"\r\n                                android:fontFamily=\"@font/nunito_semibold\"\r\n                                android:inputType=\"phone\"\r\n                                android:maxLength=\"9\"\r\n                                android:hint=\"77 XXX XXXX\"\r\n                                android:textColor=\"@color/black\"\r\n                                android:textSize=\"18sp\"\r\n                                app:libIZO_clearIconTint=\"#8f1f15\"\r\n                                app:libIZO_setBorderColor=\"#A37C07\"\r\n                                app:libIZO_setBorderView=\"true\"\r\n                                app:libIZO_setClearIconVisible=\"true\"\r\n                                app:libIZO_setCornerRadius=\"4dp\"\r\n                                app:libIZO_setPrefix=\"+91\"\r\n                                app:libIZO_setPrefixTextColor=\"#FF9800\"\r\n                                app:libIZO_setStrokeWidth=\"1dp\" />\r\n\r\n                        </LinearLayout>\r\n\r\n                        <RelativeLayout\r\n                            android:layout_width=\"0dp\"\r\n                            android:layout_height=\"match_parent\"\r\n                            android:layout_weight=\"1\">\r\n\r\n                            <ImageView\r\n\r\n                                android:layout_width=\"30dp\"\r\n                                android:layout_height=\"30dp\"\r\n                                android:layout_centerInParent=\"true\"\r\n                                android:gravity=\"center\"\r\n\r\n\r\n                                android:visibility=\"invisible\" />\r\n                        </RelativeLayout>\r\n\r\n\r\n                    </LinearLayout>\r\n\r\n\r\n                </LinearLayout>\r\n\r\n\r\n            </LinearLayout>\r\n\r\n\r\n            <LinearLayout\r\n                android:id=\"@+id/birthday_main\"\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"match_parent\"\r\n                android:layout_below=\"@+id/telephone_main\"\r\n                android:layout_marginLeft=\"15dp\"\r\n                android:layout_marginTop=\"15dp\"\r\n                android:layout_marginRight=\"15dp\">\r\n\r\n\r\n                <LinearLayout\r\n                    android:layout_width=\"match_parent\"\r\n                    android:layout_height=\"match_parent\"\r\n                    android:orientation=\"vertical\">\r\n\r\n\r\n                    <LinearLayout\r\n                        android:layout_width=\"match_parent\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:layout_marginTop=\"5dp\"\r\n                        android:orientation=\"horizontal\">\r\n\r\n                        <LinearLayout\r\n                            android:id=\"@+id/lnr_birthday\"\r\n                            android:layout_width=\"0dp\"\r\n                            android:layout_height=\"wrap_content\"\r\n                            android:layout_weight=\"6\"\r\n                            android:orientation=\"vertical\">\r\n\r\n                            <TextView\r\n\r\n                                android:layout_width=\"match_parent\"\r\n                                android:layout_height=\"20dp\"\r\n                                android:fontFamily=\"@font/nunito_regular\"\r\n                                android:gravity=\"center_vertical\"\r\n                                android:hint=\"Birthday\"\r\n                                android:textColor=\"@color/black\"\r\n                                android:textSize=\"14sp\" />\r\n\r\n                            <com.libizo.CustomEditText\r\n                                android:id=\"@+id/txt_driver_birthday\"\r\n                                android:layout_width=\"match_parent\"\r\n                                android:layout_height=\"match_parent\"\r\n                                android:layout_marginTop=\"10dp\"\r\n                                android:clickable=\"true\"\r\n                                android:cursorVisible=\"false\"\r\n                                android:focusable=\"false\"\r\n                                android:fontFamily=\"@font/nunito_semibold\"\r\n                                android:hint=\"YYYY/MM/dd\"\r\n                                android:inputType=\"none\"\r\n                                android:textColor=\"@color/black\"\r\n                                android:textSize=\"18sp\"\r\n                                app:libIZO_clearIconTint=\"#8f1f15\"\r\n                                app:libIZO_setBorderColor=\"#A37C07\"\r\n                                app:libIZO_setBorderView=\"true\"\r\n                                app:libIZO_setClearIconVisible=\"true\"\r\n                                app:libIZO_setCornerRadius=\"4dp\"\r\n                                app:libIZO_setStrokeWidth=\"1dp\" />\r\n\r\n                        </LinearLayout>\r\n\r\n                        <RelativeLayout\r\n                            android:layout_width=\"0dp\"\r\n                            android:layout_height=\"match_parent\"\r\n                            android:layout_weight=\"1\">\r\n\r\n                            <ImageView\r\n\r\n                                android:layout_width=\"30dp\"\r\n                                android:layout_height=\"30dp\"\r\n                                android:layout_centerInParent=\"true\"\r\n                                android:gravity=\"center\"\r\n\r\n\r\n                                android:visibility=\"invisible\" />\r\n                        </RelativeLayout>\r\n\r\n\r\n                    </LinearLayout>\r\n\r\n\r\n                </LinearLayout>\r\n\r\n\r\n            </LinearLayout>\r\n\r\n            <LinearLayout\r\n                android:id=\"@+id/email_drop_main\"\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"match_parent\"\r\n                android:layout_below=\"@+id/birthday_main\"\r\n                android:layout_marginLeft=\"15dp\"\r\n                android:layout_marginTop=\"15dp\"\r\n                android:layout_marginRight=\"15dp\">\r\n\r\n\r\n                <LinearLayout\r\n                    android:layout_width=\"match_parent\"\r\n                    android:layout_height=\"match_parent\"\r\n                    android:orientation=\"vertical\">\r\n\r\n\r\n                    <LinearLayout\r\n                        android:layout_width=\"match_parent\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:layout_marginTop=\"5dp\"\r\n                        android:orientation=\"horizontal\">\r\n\r\n                        <LinearLayout\r\n                            android:id=\"@+id/lnr_email\"\r\n                            android:layout_width=\"0dp\"\r\n                            android:layout_height=\"wrap_content\"\r\n                            android:layout_weight=\"6\"\r\n                            android:orientation=\"vertical\">\r\n\r\n                            <TextView\r\n\r\n                                android:layout_width=\"match_parent\"\r\n                                android:layout_height=\"20dp\"\r\n                                android:fontFamily=\"@font/nunito_regular\"\r\n                                android:gravity=\"center_vertical\"\r\n                                android:hint=\"Email\"\r\n                                android:textColor=\"@color/black\"\r\n                                android:textSize=\"14sp\" />\r\n\r\n                            <com.libizo.CustomEditText\r\n                                android:id=\"@+id/txt_email\"\r\n                                android:layout_width=\"match_parent\"\r\n                                android:layout_height=\"match_parent\"\r\n                                android:layout_marginTop=\"10dp\"\r\n                                android:fontFamily=\"@font/nunito_semibold\"\r\n                                android:inputType=\"textEmailAddress\"\r\n                                android:textColor=\"@color/black\"\r\n                                android:textSize=\"18sp\"\r\n                                app:libIZO_clearIconTint=\"#8f1f15\"\r\n                                app:libIZO_setBorderColor=\"#A37C07\"\r\n                                app:libIZO_setBorderView=\"true\"\r\n                                app:libIZO_setClearIconVisible=\"true\"\r\n                                app:libIZO_setCornerRadius=\"4dp\"\r\n                                app:libIZO_setStrokeWidth=\"1dp\" />\r\n\r\n                        </LinearLayout>\r\n\r\n                        <RelativeLayout\r\n                            android:layout_width=\"0dp\"\r\n                            android:layout_height=\"match_parent\"\r\n                            android:layout_weight=\"1\">\r\n\r\n                            <ImageView\r\n\r\n                                android:layout_width=\"30dp\"\r\n                                android:layout_height=\"30dp\"\r\n                                android:layout_centerInParent=\"true\"\r\n                                android:gravity=\"center\"\r\n\r\n\r\n                                android:visibility=\"invisible\" />\r\n                        </RelativeLayout>\r\n\r\n\r\n                    </LinearLayout>\r\n\r\n\r\n                </LinearLayout>\r\n\r\n\r\n            </LinearLayout>\r\n\r\n            <LinearLayout\r\n                android:id=\"@+id/type_main\"\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"match_parent\"\r\n                android:layout_below=\"@+id/email_drop_main\"\r\n                android:layout_marginLeft=\"15dp\"\r\n                android:layout_marginTop=\"15dp\"\r\n                android:layout_marginRight=\"15dp\">\r\n\r\n\r\n                <LinearLayout\r\n                    android:layout_width=\"match_parent\"\r\n                    android:layout_height=\"match_parent\"\r\n                    android:orientation=\"vertical\">\r\n\r\n\r\n                    <LinearLayout\r\n                        android:layout_width=\"match_parent\"\r\n                        android:layout_height=\"wrap_content\"\r\n                        android:layout_marginTop=\"5dp\"\r\n                        android:orientation=\"horizontal\">\r\n\r\n                        <LinearLayout\r\n                            android:id=\"@+id/lnr_type\"\r\n                            android:layout_width=\"0dp\"\r\n                            android:layout_height=\"wrap_content\"\r\n                            android:layout_weight=\"6\"\r\n                            android:orientation=\"vertical\">\r\n\r\n                            <TextView\r\n\r\n                                android:layout_width=\"match_parent\"\r\n                                android:layout_height=\"20dp\"\r\n                                android:fontFamily=\"@font/nunito_regular\"\r\n                                android:gravity=\"center_vertical\"\r\n                                android:hint=\"Transport Type\"\r\n                                android:textColor=\"@color/black\"\r\n                                android:textSize=\"14sp\" />\r\n\r\n                            <com.libizo.CustomEditText\r\n                                android:id=\"@+id/txt_type\"\r\n                                android:layout_width=\"match_parent\"\r\n                                android:layout_height=\"match_parent\"\r\n                                android:layout_marginTop=\"10dp\"\r\n                                android:clickable=\"true\"\r\n                                android:cursorVisible=\"false\"\r\n                                android:focusable=\"false\"\r\n                                android:fontFamily=\"@font/nunito_semibold\"\r\n                                android:inputType=\"none\"\r\n                                android:textColor=\"@color/black\"\r\n                                android:textSize=\"18sp\"\r\n                                app:libIZO_clearIconTint=\"#8f1f15\"\r\n                                app:libIZO_setBorderColor=\"#A37C07\"\r\n                                app:libIZO_setBorderView=\"true\"\r\n                                app:libIZO_setClearIconVisible=\"true\"\r\n                                app:libIZO_setCornerRadius=\"4dp\"\r\n                                app:libIZO_setStrokeWidth=\"1dp\" />\r\n\r\n                        </LinearLayout>\r\n\r\n                        <RelativeLayout\r\n                            android:layout_width=\"0dp\"\r\n                            android:layout_height=\"match_parent\"\r\n                            android:layout_weight=\"1\">\r\n\r\n                            <ImageView\r\n\r\n                                android:layout_width=\"30dp\"\r\n                                android:layout_height=\"30dp\"\r\n                                android:layout_centerInParent=\"true\"\r\n                                android:gravity=\"center\"\r\n\r\n\r\n                                android:visibility=\"invisible\" />\r\n                        </RelativeLayout>\r\n\r\n\r\n                    </LinearLayout>\r\n\r\n\r\n                </LinearLayout>\r\n\r\n\r\n            </LinearLayout>\r\n        </RelativeLayout>\r\n    </ScrollView>\r\n\r\n\r\n</FrameLayout>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout/fragment_add_driver_first.xml	(revision 357a9b0691f3a904196ae8b3f6f95a7b3825e28d)
+++ app/src/main/res/layout/fragment_add_driver_first.xml	(date 1616521057356)
@@ -339,7 +339,7 @@
                                 app:libIZO_setBorderView="true"
                                 app:libIZO_setClearIconVisible="true"
                                 app:libIZO_setCornerRadius="4dp"
-                                app:libIZO_setPrefix="+91"
+                                app:libIZO_setPrefix="+94"
                                 app:libIZO_setPrefixTextColor="#FF9800"
                                 app:libIZO_setStrokeWidth="1dp" />
 
Index: app/src/main/res/values/strings.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><resources>\r\n    <string name=\"app_name\">Get Safe Driver</string>\r\n\r\n\r\n    <string name=\"API_KEY\">AIzaSyAPrTPADT_tYmMJYjg6nZZ4jUHLJILoWpM</string>\r\n    <string name=\"AUTO_COMPLETE\">https://maps.googleapis.com/maps/api/place/autocomplete/json</string>\r\n    <string name=\"REVERSE_GEO\">https://maps.googleapis.com/maps/api/geocode/json</string>\r\n\r\n\r\n    <string name=\"BASE_URL\">http://192.168.1.3:8000/v1/getsafe/api</string>\r\n    <string name=\"SAVE_DRIVER\">/newdriver/save</string>\r\n    <string name=\"DRIVER_OTP\">/driverlogin/sendotp</string>\r\n    <string name=\"DRIVER_VALIDATE_OTP\">/driverlogin/validateotp</string>\r\n    <string name=\"UPDATE_FCM\">/fcmtoken/add</string>\r\n    <string name=\"ADD_DRIVER_DISTRICT\">/newdriver/destrict</string>\r\n    <string name=\"GET_ALL_PASSENGER_FOR_DRIVER\">/driver/journey/passengers/all</string>\r\n    <string name=\"GET_ALL_ABSENT_PASSENGER_FOR_DRIVER\">/absent/driver/get/all</string>\r\n\r\n    <string name=\"VALIDATE_TOKEN\">/driver</string>\r\n    <string name=\"DRIVER_SAVE\">/newdriver/save</string>\r\n    <string name=\"DRIVER_LOCATION\">/newdriver/location</string>\r\n    <string name=\"DRIVER_VEHICLE\">/newdriver/vehicle</string>\r\n    <string name=\"DRIVER_IMAGE\">/newdriver/driverimg</string>\r\n    <string name=\"DRIVER_NIC_FRONT\">/newdriver/nicfront</string>\r\n    <string name=\"DRIVER_NIC_BACK\">/newdriver/nicback</string>\r\n    <string name=\"DRIVER_LICENCE\">/newdriver/license</string>\r\n    <string name=\"DRIVER_VEHICLE_IMAGES\">/newdriver/vehicleimgs</string>\r\n\r\n\r\n    <string name=\"JOURNEY_LIST_MORNING\">/driver/journey/list/morning</string>\r\n    <string name=\"JOURNEY_LIST_EVENING\">/driver/journey/list/evening</string>\r\n\r\n\r\n\r\n    <string name=\"JOURNEY_START\">/driver/journey/start</string>\r\n    <string name=\"JOURNEY_END\">/driver/journey/end</string>\r\n\r\n\r\n    <string name=\"GET_ALL_PASSENGERS\">/driver/journey/passengers/all</string>\r\n    <string name=\"PASSENGER_PICKUP\">/driver/journey/picked</string>\r\n    <string name=\"PASSENGER_DROP\">/driver/journey/dropped</string>\r\n\r\n\r\n    <string name=\"INFORM_DRIVER_ARRIVAL\">/driver/journey/arrived</string>\r\n    <string name=\"MARK_PASSENGER_ABSENT\">/driver/journey/markabsent</string>\r\n\r\n    <string name=\"ACCEPT_REQUEST\">/driver/requests/accept</string>\r\n    <string name=\"DECLINE_REQUEST\">/driver/requests/decline</string>\r\n    <string name=\"VIEW_ONE_REQUEST\">/driver/requests/viewone</string>\r\n    <string name=\"VIEW_ALL_REQUEST\">/driver/requests/viewall</string>\r\n\r\n\r\n\r\n\r\n</resources>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/values/strings.xml	(revision 357a9b0691f3a904196ae8b3f6f95a7b3825e28d)
+++ app/src/main/res/values/strings.xml	(date 1616517570857)
@@ -7,7 +7,7 @@
     <string name="REVERSE_GEO">https://maps.googleapis.com/maps/api/geocode/json</string>
 
 
-    <string name="BASE_URL">http://192.168.1.3:8000/v1/getsafe/api</string>
+    <string name="BASE_URL">http://192.168.8.107:8000/v1/getsafe/api</string>
     <string name="SAVE_DRIVER">/newdriver/save</string>
     <string name="DRIVER_OTP">/driverlogin/sendotp</string>
     <string name="DRIVER_VALIDATE_OTP">/driverlogin/validateotp</string>
Index: app/src/main/java/lk/hd192/getsafedriver/Register.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package lk.hd192.getsafedriver;\r\n\r\nimport androidx.annotation.Nullable;\r\nimport androidx.fragment.app.Fragment;\r\nimport androidx.fragment.app.FragmentManager;\r\nimport androidx.fragment.app.FragmentPagerAdapter;\r\nimport androidx.viewpager.widget.ViewPager;\r\n\r\nimport android.content.Intent;\r\nimport android.net.Uri;\r\nimport android.os.Bundle;\r\nimport android.util.Log;\r\nimport android.view.View;\r\nimport android.widget.ImageView;\r\nimport android.widget.TextView;\r\n\r\nimport com.airbnb.lottie.LottieAnimationView;\r\nimport com.vlk.multimager.utils.Constants;\r\nimport com.vlk.multimager.utils.Image;\r\n\r\nimport java.io.IOException;\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\nimport lk.hd192.getsafedriver.Utils.GetSafeDriverBase;\r\nimport lk.hd192.getsafedriver.Utils.NonSwappableViewPager;\r\n\r\npublic class Register extends GetSafeDriverBase implements AddDriverFirst.RegisterCallBack, AddDriverSecond.RegisterCallSecond, AddDriverThird.RegisterCallBack,AddDriverFourth.LoadingCall {\r\n    private NonSwappableViewPager nonSwappableViewPager;\r\n    Intent intent;\r\n\r\n    ArrayList<Image> imagesList;\r\n    LottieAnimationView driverAnimation, locationAnimation, doneAnimation, vanAnimation, images, btnNext, btn_done;\r\n    AddDriverFirst addDriverFirst;\r\n    AddDriverSecond addDriverSecond;\r\n    AddDriverThird addDriverThird;\r\n    public AddDriverFourth addDriverFourth;\r\n    TextView txtSubHeading;\r\n    public static boolean firstCompleted = false, secondCompleted = false;\r\n    int currentPage = 1;\r\n    View view;\r\n    LottieAnimationView loading;\r\n\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_register);\r\n        addDriverFirst = new AddDriverFirst();\r\n        addDriverSecond = new AddDriverSecond();\r\n        addDriverThird = new AddDriverThird();\r\n        addDriverFourth = new AddDriverFourth();\r\n\r\n        nonSwappableViewPager = findViewById(R.id.view_pager_container);\r\n        btnNext = findViewById(R.id.btn_next);\r\n        driverAnimation = findViewById(R.id.driver_animation);\r\n        doneAnimation = findViewById(R.id.done_animation);\r\n        vanAnimation = findViewById(R.id.van_animation);\r\n        locationAnimation = findViewById(R.id.location_animation);\r\n        images = findViewById(R.id.images_animation);\r\n        btn_done = findViewById(R.id.btn_done);\r\n\r\n        loading = findViewById(R.id.loading);\r\n        view = findViewById(R.id.disable_layout);\r\n\r\n        nonSwappableViewPager.setOffscreenPageLimit(1);\r\n        setupViewPager(nonSwappableViewPager);\r\n        btn_done.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                if (currentPage == 4) {\r\n\r\n                    try {\r\n                        addDriverFourth.convertToBase64AndUpload();\r\n                    } catch (IOException e) {\r\n                        e.printStackTrace();\r\n                    }}\r\n            }\r\n        });\r\n        btnNext.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n\r\n                if (currentPage == 1)\r\n\r\n\r\n//                    addDriverFirst.validateFields();\r\n                    showPageFour();\r\n\r\n                else if (currentPage == 2)\r\n\r\n                    addDriverSecond.validateFields();\r\n\r\n\r\n                else if (currentPage == 3) {\r\n\r\n                    addDriverThird.validateFields();\r\n\r\n\r\n\r\n\r\n//                        txtSubHeading.setText(\"Vehicle Details\");\r\n//                        vanAnimation.setVisibility(View.VISIBLE);\r\n//                        locationAnimation.setVisibility(View.GONE);\r\n//                        driverAnimation.setVisibility(View.GONE);\r\n//                        currentPage = 4;\r\n\r\n//                    }\r\n\r\n\r\n                }\r\n\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    @Override\r\n    public void showPageTwo() {\r\n\r\n        nonSwappableViewPager.setCurrentItem(1);\r\n//                        txtSubHeading.setText(\"Location Details\");\r\n        driverAnimation.setVisibility(View.GONE);\r\n        doneAnimation.setVisibility(View.GONE);\r\n        locationAnimation.setVisibility(View.VISIBLE);\r\n        currentPage = 2;\r\n\r\n\r\n    }\r\n\r\n\r\n    @Override\r\n    public void showPageFour() {\r\n        nonSwappableViewPager.setCurrentItem(3);\r\n//                        txtSubHeading.setText(\"Vehicle Details\");\r\n        images.setVisibility(View.VISIBLE);\r\n        locationAnimation.setVisibility(View.GONE);\r\n        vanAnimation.setVisibility(View.GONE);\r\n        btnNext.setVisibility(View.GONE);\r\n        currentPage = 4;\r\n\r\n        btn_done.setVisibility(View.VISIBLE);\r\n\r\n    }\r\n\r\n    @Override\r\n    public void showPageThree() {\r\n        Log.e(\"page three\", \"exe\");\r\n        nonSwappableViewPager.setCurrentItem(2);\r\n//                        txtSubHeading.setText(\"Vehicle Details\");\r\n        vanAnimation.setVisibility(View.VISIBLE);\r\n        locationAnimation.setVisibility(View.GONE);\r\n        driverAnimation.setVisibility(View.GONE);\r\n        currentPage = 3;\r\n\r\n    }\r\n\r\n    @Override\r\n    public void showLoadingImage() {\r\n        view.setVisibility(View.VISIBLE);\r\n        loading.setVisibility(View.VISIBLE);\r\n        loading.playAnimation();\r\n\r\n    }\r\n\r\n    @Override\r\n    public void hideLoadingImage() {\r\n        loading.setVisibility(View.GONE);\r\n        view.setVisibility(View.GONE);\r\n    }\r\n\r\n\r\n    public class SectionsPagerAdapter extends FragmentPagerAdapter {\r\n\r\n        private final List<Fragment> mFragmentList = new ArrayList<>();\r\n\r\n        public SectionsPagerAdapter(FragmentManager fm) {\r\n            super(fm);\r\n        }\r\n\r\n        @Override\r\n        public Fragment getItem(int position) {\r\n\r\n            return mFragmentList.get(position);\r\n\r\n        }\r\n\r\n        public void addFragment(Fragment fragment) {\r\n            mFragmentList.add(fragment);\r\n        }\r\n\r\n        @Override\r\n        public int getCount() {\r\n\r\n            return 4;\r\n        }\r\n    }\r\n\r\n    private void setupViewPager(ViewPager viewPager) {\r\n        SectionsPagerAdapter sectionsPager = new SectionsPagerAdapter(getSupportFragmentManager());\r\n\r\n        sectionsPager.addFragment(addDriverFirst);\r\n        sectionsPager.addFragment(addDriverSecond);\r\n        sectionsPager.addFragment(addDriverThird);\r\n        sectionsPager.addFragment(addDriverFourth);\r\n\r\n        viewPager.setAdapter(sectionsPager);\r\n    }\r\n\r\n    @Override\r\n    public void onActivityResult(int requestCode, int resultCode, Intent data) {\r\n        super.onActivityResult(requestCode, resultCode, data);\r\n\r\n        for (Fragment fragment : getSupportFragmentManager().getFragments()) {\r\n            if (fragment == addDriverFourth)\r\n\r\n                fragment.onActivityResult(requestCode, resultCode, data);\r\n        }\r\n    }\r\n\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/lk/hd192/getsafedriver/Register.java	(revision 357a9b0691f3a904196ae8b3f6f95a7b3825e28d)
+++ app/src/main/java/lk/hd192/getsafedriver/Register.java	(date 1616521651118)
@@ -84,8 +84,8 @@
                 if (currentPage == 1)
 
 
-//                    addDriverFirst.validateFields();
-                    showPageFour();
+                    addDriverFirst.validateFields();
+//                    showPageTwo();
 
                 else if (currentPage == 2)
 
Index: app/src/main/java/lk/hd192/getsafedriver/Home.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package lk.hd192.getsafedriver;\r\n\r\nimport androidx.core.content.ContextCompat;\r\nimport androidx.recyclerview.widget.StaggeredGridLayoutManager;\r\n\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\nimport android.view.View;\r\n\r\nimport lk.hd192.getsafedriver.Utils.GetSafeDriverBase;\r\nimport lk.hd192.getsafedriver.Utils.TinyDB;\r\n\r\npublic class Home extends GetSafeDriverBase {\r\n\r\n    //    RecyclerView recyclerHome;\r\n    StaggeredGridLayoutManager staggeredGridLayoutManager;\r\n    TinyDB tinyDB;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_home);\r\n        getWindow().setStatusBarColor(ContextCompat.getColor(getApplicationContext(), R.color.yellow_te));\r\n        getWindow().getDecorView().setSystemUiVisibility(View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR);\r\n\r\n        tinyDB = new TinyDB(getApplicationContext());\r\n\r\n//        recyclerHome = findViewById(R.id.recycler_home);\r\n\r\n//        recyclerHome.setAdapter(new HomeItemAdapter());\r\n//        recyclerHome.setLayoutManager(new GridLayoutManager(getApplicationContext(), 2));\r\n//        staggeredGridLayoutManager = new StaggeredGridLayoutManager(2, StaggeredGridLayoutManager.VERTICAL);\r\n//        staggeredGridLayoutManager.setGapStrategy(StaggeredGridLayoutManager.GAP_HANDLING_NONE);\r\n//\r\n//        recyclerHome.setLayoutManager(staggeredGridLayoutManager);\r\n//        recyclerHome.getAdapter().notifyDataSetChanged();\r\n\r\n        tinyDB.putBoolean(\"isStaffDriver\", false);\r\n        tinyDB.putString(\"token\", \"5|FCvVjDwVYsfKctZy3wqjhU2MngV8UwTJtBWRqBdY\");\r\n\r\n\r\n        homeRoutes();\r\n\r\n\r\n    }\r\n\r\n    private void homeRoutes() {\r\n\r\n\r\n        findViewById(R.id.card_absence).setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                startActivity(new Intent(getApplicationContext(), Absence.class));\r\n            }\r\n        });\r\n        findViewById(R.id.card_request).setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                startActivity(new Intent(getApplicationContext(), NewRequest.class));\r\n            }\r\n        });\r\n        findViewById(R.id.card_map).setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                startActivity(new Intent(getApplicationContext(), Map.class));\r\n            }\r\n        });\r\n        findViewById(R.id.card_message).setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                startActivity(new Intent(getApplicationContext(), Message.class));\r\n            }\r\n        });\r\n        findViewById(R.id.card_payment).setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                startActivity(new Intent(getApplicationContext(), Payment.class));\r\n            }\r\n        });\r\n\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/lk/hd192/getsafedriver/Home.java	(revision 357a9b0691f3a904196ae8b3f6f95a7b3825e28d)
+++ app/src/main/java/lk/hd192/getsafedriver/Home.java	(date 1616524260873)
@@ -36,7 +36,7 @@
 //        recyclerHome.getAdapter().notifyDataSetChanged();
 
         tinyDB.putBoolean("isStaffDriver", false);
-        tinyDB.putString("token", "5|FCvVjDwVYsfKctZy3wqjhU2MngV8UwTJtBWRqBdY");
+        tinyDB.putString("token", "4|qqN4kduiShWiToBv620F2IWYRnxtkprgwXYSJ4rv");
 
 
         homeRoutes();
